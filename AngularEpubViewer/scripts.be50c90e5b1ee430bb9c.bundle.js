!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.RSVP=e.RSVP||{})}(this,function(e){"use strict";function t(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function r(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}var n={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,n){if("function"!=typeof n)throw new TypeError("Callback must be a function");var i=r(this),o=void 0;(o=i[e])||(o=i[e]=[]),-1===t(o,n)&&o.push(n)},off:function(e,n){var i,o=r(this),s=void 0;n?-1!==(i=t(s=o[e],n))&&s.splice(i,1):o[e]=[]},trigger:function(e,t,n){var i;if(i=r(this)[e])for(var o=0;o<i.length;o++)(0,i[o])(t,n)}},i={instrument:!1};function o(e,t){if("onerror"!==e)return 2!==arguments.length?i[e]:void(i[e]=t);i.on("error",t)}function s(e){return"function"==typeof e}n.mixin(i);var a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},c=Date.now||function(){return(new Date).getTime()};function h(){}var u=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return h.prototype=e,new h},l=[];function d(e,t,r){1===l.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:r&&r._id,label:t._label,timeStamp:c(),error:i["instrument-with-stack"]?new Error(t._label):null}})&&setTimeout(function(){for(var e=0;e<l.length;e++){var t=l[e],r=t.payload;r.guid=r.key+r.id,r.childGuid=r.key+r.childId,r.error&&(r.stack=r.error.stack),i.trigger(t.name,t.payload)}l.length=0},50)}function f(e,t){if(e&&"object"==typeof e&&e.constructor===this)return e;var r=new this(p,t);return _(r,e),r}function p(){}var g=void 0,m=1,y=2,v=new U;function b(e){try{return e.then}catch(e){return v.error=e,v}}function E(e,t,r){t.constructor===e.constructor&&r===R&&e.constructor.resolve===f?function(e,t){t._state===m?w(e,t._result):t._state===y?(t._onError=null,P(e,t._result)):B(t,void 0,function(r){t!==r?_(e,r):w(e,r)},function(t){return P(e,t)})}(e,t):r===v?(P(e,v.error),v.error=null):void 0===r?w(e,t):s(r)?function(e,t,r){i.async(function(e){var n=!1,i=function(r,i,o,s){try{r.call(i,function(r){n||(n=!0,t!==r?_(e,r):w(e,r))},function(t){n||(n=!0,P(e,t))})}catch(e){return e}}(r,t);!n&&i&&(n=!0,P(e,i))},e)}(e,t,r):w(e,t)}function _(e,t){var r;e===t?w(e,t):"function"==typeof(r=t)||"object"==typeof r&&null!==r?E(e,t,b(t)):w(e,t)}function S(e){e._onError&&e._onError(e._result),x(e)}function w(e,t){e._state===g&&(e._result=t,e._state=m,0===e._subscribers.length?i.instrument&&d("fulfilled",e):i.async(x,e))}function P(e,t){e._state===g&&(e._state=y,e._result=t,i.async(S,e))}function B(e,t,r,n){var o=e._subscribers,s=o.length;e._onError=null,o[s]=t,o[s+m]=r,o[s+y]=n,0===s&&e._state&&i.async(x,e)}function x(e){var t=e._subscribers,r=e._state;if(i.instrument&&d(r===m?"fulfilled":"rejected",e),0!==t.length){for(var n=void 0,o=void 0,s=e._result,a=0;a<t.length;a+=3)o=t[a+r],(n=t[a])?C(r,n,o,s):o(s);e._subscribers.length=0}}function U(){this.error=null}var k=new U;function C(e,t,r,n){var i=s(r),o=void 0,a=void 0,c=void 0,h=void 0;if(i){if((o=function(e,t){try{return e(t)}catch(e){return k.error=e,k}}(r,n))===k?(h=!0,a=o.error,o.error=null):c=!0,t===o)return void P(t,new TypeError("A promises callback cannot return that same promise."))}else o=n,c=!0;t._state!==g||(i&&c?_(t,o):h?P(t,a):e===m?w(t,o):e===y&&P(t,o))}function R(e,t,r){var n=arguments,o=this._state;if(o===m&&!e||o===y&&!t)return i.instrument&&d("chained",this,this),this;this._onError=null;var s,a=new this.constructor(p,r),c=this._result;return i.instrument&&d("chained",this,a),o?(s=n[o-1],i.async(function(){return C(o,a,s,c)})):B(this,a,e,t),a}function J(e,t,r){return e===m?{state:"fulfilled",value:r}:{state:"rejected",reason:r}}function I(e,t,r,n){this._instanceConstructor=e,this.promise=new e(p,n),this._abortOnReject=r,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&w(this.promise,this._result))):P(this.promise,this._validationError())}I.prototype._validateInput=function(e){return a(e)},I.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},I.prototype._init=function(){this._result=new Array(this.length)},I.prototype._enumerate=function(){for(var e=this.length,t=this.promise,r=this._input,n=0;t._state===g&&n<e;n++)this._eachEntry(r[n],n)},I.prototype._settleMaybeThenable=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===f){var i=b(e);if(i===R&&e._state!==g)e._onError=null,this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=this._makeResult(m,t,e);else if(r===L){var o=new r(p);E(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},I.prototype._eachEntry=function(e,t){var r;"object"==typeof(r=e)&&null!==r?this._settleMaybeThenable(e,t):(this._remaining--,this._result[t]=this._makeResult(m,t,e))},I.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===g&&(this._remaining--,this._abortOnReject&&e===y?P(n,r):this._result[t]=this._makeResult(e,t,r)),0===this._remaining&&w(n,this._result)},I.prototype._makeResult=function(e,t,r){return r},I.prototype._willSettleAt=function(e,t){var r=this;B(e,void 0,function(e){return r._settledAt(m,t,e)},function(e){return r._settledAt(y,t,e)})};var A="rsvp_"+c()+"-",T=0;function L(e,t){this._id=T++,this._label=t,this._state=void 0,this._result=void 0,this._subscribers=[],i.instrument&&d("created",this),p!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof L?function(e,t){var r=!1;try{t(function(t){r||(r=!0,_(e,t))},function(t){r||(r=!0,P(e,t))})}catch(t){P(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}function O(){this.value=void 0}L.cast=f,L.all=function(e,t){return new I(this,e,!0,t).promise},L.race=function(e,t){var r=new this(p,t);if(!a(e))return P(r,new TypeError("You must pass an array to race.")),r;for(var n=0;r._state===g&&n<e.length;n++)B(this.resolve(e[n]),void 0,function(e){return _(r,e)},function(e){return P(r,e)});return r},L.resolve=f,L.reject=function(e,t){var r=new this(p,t);return P(r,e),r},L.prototype={constructor:L,_guidKey:A,_onError:function(e){var t=this;i.after(function(){t._onError&&i.trigger("error",e,t._label)})},then:R,catch:function(e,t){return this.then(void 0,e,t)},finally:function(e,t){var r=this.constructor;return this.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})},t)}};var N=new O,z=new O;function F(e,t,r){try{e.apply(t,r)}catch(e){return N.value=e,N}}function D(e,t){return{then:function(r,n){return e.call(t,r,n)}}}function j(e,t){var r=function(){for(var r=arguments.length,n=new Array(r+1),i=!1,o=0;o<r;++o){var s=arguments[o];if(!i){if((i=M(s))===z){var c=new L(p);return P(c,z.value),c}i&&!0!==i&&(s=D(i,s))}n[o]=s}var h=new L(p);return n[r]=function(e,r){e?P(h,e):void 0===t?_(h,r):!0===t?_(h,function(e){for(var t=e.length,r=new Array(t-1),n=1;n<t;n++)r[n-1]=e[n];return r}(arguments)):a(t)?_(h,function(e,t){for(var r={},n=e.length,i=new Array(n),o=0;o<n;o++)i[o]=e[o];for(var s=0;s<t.length;s++)r[t[s]]=i[s+1];return r}(arguments,t)):_(h,r)},i?function(e,t,r,n){return L.all(t).then(function(t){var i=F(r,n,t);return i===N&&P(e,i.value),e})}(h,n,e,this):function(e,t,r,n){var i=F(r,n,t);return i===N&&P(e,i.value),e}(h,n,e,this)};return r.__proto__=e,r}function M(e){return!(!e||"object"!=typeof e)&&(e.constructor===L||function(e){try{return e.then}catch(e){return N.value=e,N}}(e))}function q(e,t){return L.all(e,t)}function W(e,t,r){this._superConstructor(e,t,!1,r)}function H(e,t){return new W(L,e,t).promise}function V(e,t){return L.race(e,t)}function X(e,t,r){this._superConstructor(e,t,!0,r)}function Z(e,t){return new X(L,e,t).promise}function K(e,t,r){this._superConstructor(e,t,!1,r)}function Y(e,t){return new K(L,e,t).promise}function G(e){throw setTimeout(function(){throw e}),e}function Q(e){var t={resolve:void 0,reject:void 0};return t.promise=new L(function(e,r){t.resolve=e,t.reject=r},e),t}function $(e,t,r){return L.all(e,r).then(function(e){if(!s(t))throw new TypeError("You must pass a function as map's second argument.");for(var n=e.length,i=new Array(n),o=0;o<n;o++)i[o]=t(e[o]);return L.all(i,r)})}function ee(e,t){return L.resolve(e,t)}function te(e,t){return L.reject(e,t)}function re(e,t){return L.all(e,t)}function ne(e,t,r){return(a(e)?re(e,r):function(t,r){return L.resolve(e,r).then(function(e){return re(e,r)})}(0,r)).then(function(e){if(!s(t))throw new TypeError("You must pass a function as filter's second argument.");for(var n=e.length,i=new Array(n),o=0;o<n;o++)i[o]=t(e[o]);return re(i,r).then(function(t){for(var r=new Array(n),i=0,o=0;o<n;o++)t[o]&&(r[i]=e[o],i++);return r.length=i,r})})}(W.prototype=u(I.prototype))._superConstructor=I,W.prototype._makeResult=J,W.prototype._validationError=function(){return new Error("allSettled must be called with an array")},(X.prototype=u(I.prototype))._superConstructor=I,X.prototype._init=function(){this._result={}},X.prototype._validateInput=function(e){return e&&"object"==typeof e},X.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},X.prototype._enumerate=function(){var e=this.promise,t=this._input,r=[];for(var n in t)e._state===g&&Object.prototype.hasOwnProperty.call(t,n)&&r.push({position:n,entry:t[n]});var i=r.length;this._remaining=i;for(var o=void 0,s=0;e._state===g&&s<i;s++)this._eachEntry((o=r[s]).entry,o.position)},(K.prototype=u(X.prototype))._superConstructor=I,K.prototype._makeResult=J,K.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var ie=0,oe=void 0;function se(e,t){fe[ie]=e,fe[ie+1]=t,2===(ie+=2)&&Se()}var ae="undefined"!=typeof window?window:void 0,ce=ae||{},he=ce.MutationObserver||ce.WebKitMutationObserver,ue="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),le="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function de(){return function(){return setTimeout(pe,1)}}var fe=new Array(1e3);function pe(){for(var e=0;e<ie;e+=2)(0,fe[e])(fe[e+1]),fe[e]=void 0,fe[e+1]=void 0;ie=0}var ge,me,ye,ve,be,Ee,_e,Se=void 0;if(ue?(be=process.nextTick,Ee=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/),Array.isArray(Ee)&&"0"===Ee[1]&&"10"===Ee[2]&&(be=setImmediate),Se=function(){return be(pe)}):he?(me=0,ye=new he(pe),ve=document.createTextNode(""),ye.observe(ve,{characterData:!0}),Se=function(){return ve.data=me=++me%2}):le?((ge=new MessageChannel).port1.onmessage=pe,Se=function(){return ge.port2.postMessage(0)}):Se=void 0===ae&&"function"==typeof require?function(){try{var e=require("vertx");return"undefined"!=typeof(oe=e.runOnLoop||e.runOnContext)?function(){oe(pe)}:de()}catch(e){return de()}}():de(),"object"==typeof self)self;else{if("object"!=typeof global)throw new Error("no global: `self` or `global` found");global}function we(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}i.async=se,i.after=function(e){return setTimeout(e,0)};var Pe=ee,Be=function(e,t){return i.async(e,t)};function xe(){i.on.apply(i,arguments)}function Ue(){i.off.apply(i,arguments)}if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var ke=window.__PROMISE_INSTRUMENTATION__;for(var Ce in o("instrument",!0),ke)ke.hasOwnProperty(Ce)&&xe(Ce,ke[Ce])}var Re=(we(_e={asap:se,cast:Pe,Promise:L,EventTarget:n,all:q,allSettled:H,race:V,hash:Z,hashSettled:Y,rethrow:G,defer:Q,denodeify:j,configure:o,on:xe,off:Ue,resolve:ee,reject:te,map:$},"async",Be),we(_e,"filter",ne),_e);e.default=Re,e.asap=se,e.cast=Pe,e.Promise=L,e.EventTarget=n,e.all=q,e.allSettled=H,e.race=V,e.hash=Z,e.hashSettled=Y,e.rethrow=G,e.defer=Q,e.denodeify=j,e.configure=o,e.on=xe,e.off=Ue,e.resolve=ee,e.reject=te,e.map=$,e.async=Be,e.filter=ne,Object.defineProperty(e,"__esModule",{value:!0})}),(EPUBJS=EPUBJS||{}).VERSION="0.2.19",EPUBJS.plugins=EPUBJS.plugins||{},EPUBJS.filePath=EPUBJS.filePath||"/epubjs/",EPUBJS.Render={},function(e){var t=window.ePub=function(){var e,t;return"undefined"!=typeof arguments[0]&&("string"==typeof arguments[0]||arguments[0]instanceof ArrayBuffer)&&(e=arguments[0],arguments[1]&&"object"==typeof arguments[1]?(t=arguments[1]).bookPath=e:t={bookPath:e}),!arguments[0]||"object"!=typeof arguments[0]||arguments[0]instanceof ArrayBuffer||(t=arguments[0]),new EPUBJS.Book(t)};"function"==typeof define&&define.amd?define(["rsvp","jszip","localforage"],function(e,r,n){return t}):"undefined"!=typeof module&&module.exports&&(global.RSVP=require("rsvp"),global.JSZip=require("jszip"),global.localForage=require("localforage"),module.exports=t)}(),EPUBJS.Book=function(e){this.settings=EPUBJS.core.defaults(e||{},{bookPath:void 0,bookKey:void 0,packageUrl:void 0,storage:!1,fromStorage:!1,saved:!1,online:!0,contained:!1,width:void 0,height:void 0,layoutOveride:void 0,orientation:void 0,minSpreadWidth:768,gap:"auto",version:1,restore:!1,reload:!1,goto:!1,styles:{},classes:[],headTags:{},withCredentials:!1,render_method:"Iframe",displayLastPage:!1}),this.settings.EPUBJSVERSION=EPUBJS.VERSION,this.spinePos=0,this.stored=!1,this.online=this.settings.online||navigator.onLine,this.networkListeners(),this.ready={manifest:new RSVP.defer,spine:new RSVP.defer,metadata:new RSVP.defer,cover:new RSVP.defer,toc:new RSVP.defer,pageList:new RSVP.defer},this.readyPromises=[this.ready.manifest.promise,this.ready.spine.promise,this.ready.metadata.promise,this.ready.cover.promise,this.ready.toc.promise],this.pageList=[],this.pagination=new EPUBJS.Pagination,this.pageListReady=this.ready.pageList.promise,this.ready.all=RSVP.all(this.readyPromises),this.ready.all.then(this._ready.bind(this)),this.isRendered=!1,this._q=EPUBJS.core.queue(this),this._rendering=!1,this._displayQ=EPUBJS.core.queue(this),this._moving=!1,this._gotoQ=EPUBJS.core.queue(this),this.renderer=new EPUBJS.Renderer(this.settings.render_method),this.renderer.setMinSpreadWidth(this.settings.minSpreadWidth),this.renderer.setGap(this.settings.gap),this.listenToRenderer(this.renderer),this.defer_opened=new RSVP.defer,this.opened=this.defer_opened.promise,this.store=!1,!1!==this.settings.storage&&this.fromStorage(!0),("string"==typeof this.settings.bookPath||this.settings.bookPath instanceof ArrayBuffer)&&this.open(this.settings.bookPath,this.settings.reload),window.addEventListener("beforeunload",this.unload.bind(this),!1)},EPUBJS.Book.prototype.open=function(e,t){var r,n=this,i=new RSVP.defer;return this.settings.bookPath=e,this.settings.contained||this.isContained(e)?(this.settings.contained=this.contained=!0,this.bookUrl="",r=this.unarchive(e).then(function(){return n.loadPackage()})):(this.bookUrl=this.urlFrom(e),r=this.loadPackage()),this.settings.restore&&!t&&localStorage?r.then(function(e){var t=n.packageIdentifier(e);n.restore(t)||n.unpack(e),i.resolve(),n.defer_opened.resolve()}):r.then(function(e){n.unpack(e),i.resolve(),n.defer_opened.resolve()}),this._registerReplacements(this.renderer),i.promise},EPUBJS.Book.prototype.loadPackage=function(e){var t,r=this,n=new EPUBJS.Parser,i=e||"META-INF/container.xml";return(t=this.settings.packageUrl?r.loadXml(r.settings.packageUrl):r.loadXml(r.bookUrl+i).then(function(e){return n.container(e)}).then(function(e){return r.settings.contentsPath=r.bookUrl+e.basePath,r.settings.packageUrl=r.bookUrl+e.packagePath,r.settings.encoding=e.encoding,r.loadXml(r.settings.packageUrl)})).catch(function(e){console.error("Could not load book at: "+i),r.trigger("book:loadFailed",i)}),t},EPUBJS.Book.prototype.packageIdentifier=function(e){return(new EPUBJS.Parser).identifier(e)},EPUBJS.Book.prototype.unpack=function(e){var t=this,r=new EPUBJS.Parser;t.contents=r.packageContents(e,t.settings.contentsPath),t.manifest=t.contents.manifest,t.spine=t.contents.spine,t.spineIndexByURL=t.contents.spineIndexByURL,t.metadata=t.contents.metadata,t.settings.bookKey||(t.settings.bookKey=t.generateBookKey(t.metadata.identifier)),t.globalLayoutProperties=t.parseLayoutProperties(t.metadata),t.contents.coverPath&&(t.cover=t.contents.cover=t.settings.contentsPath+t.contents.coverPath),t.spineNodeIndex=t.contents.spineNodeIndex,t.ready.manifest.resolve(t.contents.manifest),t.ready.spine.resolve(t.contents.spine),t.ready.metadata.resolve(t.contents.metadata),t.ready.cover.resolve(t.contents.cover),t.locations=new EPUBJS.Locations(t.spine,t.store,t.settings.withCredentials),t.contents.navPath?(t.settings.navUrl=t.settings.contentsPath+t.contents.navPath,t.loadXml(t.settings.navUrl).then(function(e){return r.nav(e,t.spineIndexByURL,t.spine)}).then(function(e){t.toc=t.contents.toc=e,t.ready.toc.resolve(t.contents.toc)},function(e){t.ready.toc.resolve(!1)}),t.loadXml(t.settings.navUrl).then(function(e){return r.pageList(e,t.spineIndexByURL,t.spine)}).then(function(e){var r=new EPUBJS.EpubCFI,n=0;0!==e.length&&(t.pageList=t.contents.pageList=e,t.pageList.forEach(function(e){e.cfi||(n+=1,r.generateCfiFromHref(e.href,t).then(function(r){e.cfi=r,e.packageUrl=t.settings.packageUrl,0==(n-=1)&&(t.pagination.process(t.pageList),t.ready.pageList.resolve(t.pageList))}))}),n||(t.pagination.process(t.pageList),t.ready.pageList.resolve(t.pageList)))},function(e){t.ready.pageList.resolve([])})):t.contents.tocPath?(t.settings.tocUrl=t.settings.contentsPath+t.contents.tocPath,t.loadXml(t.settings.tocUrl).then(function(e){return r.toc(e,t.spineIndexByURL,t.spine)},function(e){console.error(e)}).then(function(e){t.toc=t.contents.toc=e,t.ready.toc.resolve(t.contents.toc)},function(e){t.ready.toc.resolve(!1)})):t.ready.toc.resolve(!1)},EPUBJS.Book.prototype.createHiddenRender=function(e,t,r){var n,i,o=this.element.getBoundingClientRect(),s=t||this.settings.width||o.width,a=r||this.settings.height||o.height;return e.setMinSpreadWidth(this.settings.minSpreadWidth),e.setGap(this.settings.gap),this._registerReplacements(e),this.settings.forceSingle&&e.forceSingle(!0),(n=document.createElement("div")).style.visibility="hidden",n.style.overflow="hidden",n.style.width="0",n.style.height="0",this.element.appendChild(n),(i=document.createElement("div")).style.visibility="hidden",i.style.overflow="hidden",i.style.width=s+"px",i.style.height=a+"px",n.appendChild(i),e.initialize(i,this.settings.width,this.settings.height),n},EPUBJS.Book.prototype.generatePageList=function(e,t,r){var n=[],i=new EPUBJS.Renderer(this.settings.render_method,!1),o=this.createHiddenRender(i,e,t),s=new RSVP.defer,a=-1,c=this.spine.length,h=0,u=(function(e){var t,s=a+1,l=e||new RSVP.defer;if(s>=c)l.resolve();else{if(r&&r.cancelled)return i.remove(),this.element.removeChild(o),void l.reject(new Error("User cancelled"));t=new EPUBJS.Chapter(this.spine[a=s],this.store),i.displayChapter(t,this.globalLayoutProperties).then(function(e){i.pageMap.forEach(function(e){n.push({cfi:e.start,page:h+=1})}),i.pageMap.length%2>0&&i.spreads&&n.push({cfi:i.pageMap[i.pageMap.length-1].end,page:h+=1}),setTimeout(function(){u(l)},1)})}return l.promise}).bind(this);return u().then((function(){i.remove(),this.element.removeChild(o),s.resolve(n)}).bind(this),function(e){s.reject(e)}),s.promise},EPUBJS.Book.prototype.generatePagination=function(e,t,r){var n=this,i=new RSVP.defer;return this.ready.spine.promise.then(function(){n.generatePageList(e,t,r).then(function(e){n.pageList=n.contents.pageList=e,n.pagination.process(e),n.ready.pageList.resolve(n.pageList),i.resolve(n.pageList)},function(e){i.reject(e)})}),i.promise},EPUBJS.Book.prototype.loadPagination=function(e){var t;return(t="string"==typeof e?JSON.parse(e):e)&&t.length&&(this.pageList=t,this.pagination.process(this.pageList),this.ready.pageList.resolve(this.pageList)),this.pageList},EPUBJS.Book.prototype.getPageList=function(){return this.ready.pageList.promise},EPUBJS.Book.prototype.getMetadata=function(){return this.ready.metadata.promise},EPUBJS.Book.prototype.getToc=function(){return this.ready.toc.promise},EPUBJS.Book.prototype.networkListeners=function(){var e=this;window.addEventListener("offline",function(t){e.online=!1,e.settings.storage&&e.fromStorage(!0),e.trigger("book:offline")},!1),window.addEventListener("online",function(t){e.online=!0,e.settings.storage&&e.fromStorage(!1),e.trigger("book:online")},!1)},EPUBJS.Book.prototype.listenToRenderer=function(e){var t=this;e.Events.forEach(function(r){e.on(r,function(e){t.trigger(r,e)})}),e.on("renderer:visibleRangeChanged",(function(e){var t,r,n,i=[];this.pageList.length>0&&(t=this.pagination.pageFromCfi(e.start),n=this.pagination.percentageFromPage(t),i.push(t),e.end&&(r=this.pagination.pageFromCfi(e.end),i.push(r)),this.trigger("book:pageChanged",{anchorPage:t,percentage:n,pageRange:i}))}).bind(this)),e.on("render:loaded",this.loadChange.bind(this))},EPUBJS.Book.prototype.loadChange=function(e){var t,r=EPUBJS.core.uri(e),n=EPUBJS.core.uri(this.currentChapter.absolute);r.path!=n.path?(console.warn("Miss Match",r.path,this.currentChapter.absolute),t=new EPUBJS.Chapter(this.spine[this.spineIndexByURL[r.filename]],this.store),this.currentChapter=t,this.renderer.currentChapter=t,this.renderer.afterLoad(this.renderer.render.docEl),this.renderer.beforeDisplay((function(){this.renderer.afterDisplay()}).bind(this))):this._rendering||this.renderer.reformat()},EPUBJS.Book.prototype.unlistenToRenderer=function(e){e.Events.forEach(function(t){e.off(t)})},EPUBJS.Book.prototype.coverUrl=function(){var e=this.ready.cover.promise.then((function(e){return this.settings.fromStorage?this.store.getUrl(this.contents.cover):this.settings.contained?this.zip.getUrl(this.contents.cover):this.contents.cover}).bind(this));return e.then((function(e){this.cover=e}).bind(this)),e},EPUBJS.Book.prototype.loadXml=function(e){return this.settings.fromStorage?this.store.getXml(e,this.settings.encoding):this.settings.contained?this.zip.getXml(e,this.settings.encoding):EPUBJS.core.request(e,"xml",this.settings.withCredentials)},EPUBJS.Book.prototype.urlFrom=function(e){var t,r=EPUBJS.core.uri(e),n=r.protocol,i="/"==r.path[0],o=window.location,s=o.origin||o.protocol+"//"+o.host,a=document.getElementsByTagName("base");return a.length&&(t=a[0].href),r.protocol?r.origin+r.path:!n&&i?(t||s)+r.path:n||i?void 0:EPUBJS.core.resolveUrl(t||o.pathname,r.path)},EPUBJS.Book.prototype.unarchive=function(e){return this.zip=new EPUBJS.Unarchiver,this.store=this.zip,this.zip.open(e)},EPUBJS.Book.prototype.isContained=function(e){if(e instanceof ArrayBuffer)return!0;var t=EPUBJS.core.uri(e);return!(!t.extension||"epub"!=t.extension&&"zip"!=t.extension)},EPUBJS.Book.prototype.isSaved=function(e){var t;return!(!localStorage||(t=localStorage.getItem(e),!localStorage||null===t))},EPUBJS.Book.prototype.generateBookKey=function(e){return"epubjs:"+EPUBJS.VERSION+":"+window.location.host+":"+e},EPUBJS.Book.prototype.saveContents=function(){if(!localStorage)return!1;localStorage.setItem(this.settings.bookKey,JSON.stringify(this.contents))},EPUBJS.Book.prototype.removeSavedContents=function(){if(!localStorage)return!1;localStorage.removeItem(this.settings.bookKey)},EPUBJS.Book.prototype.renderTo=function(e){var t=this;if(EPUBJS.core.isElement(e))this.element=e;else{if("string"!=typeof e)return void console.error("Not an Element");this.element=EPUBJS.core.getEl(e)}return this.opened.then(function(){return t.renderer.initialize(t.element,t.settings.width,t.settings.height),t.metadata.direction&&t.renderer.setDirection(t.metadata.direction),t._rendered(),t.startDisplay()})},EPUBJS.Book.prototype.startDisplay=function(){return this.settings.goto?this.goto(this.settings.goto):this.settings.previousLocationCfi?this.gotoCfi(this.settings.previousLocationCfi):this.displayChapter(this.spinePos,this.settings.displayLastPage)},EPUBJS.Book.prototype.restore=function(e){var t,r=["manifest","spine","metadata","cover","toc","spineNodeIndex","spineIndexByURL","globalLayoutProperties"],n=!1,i=this.generateBookKey(e),o=localStorage.getItem(i),s=r.length;if(this.settings.clearSaved&&(n=!0),!n&&"undefined"!=o&&null!==o)for(this.contents=JSON.parse(o),t=0;t<s;t++){var a=r[t];if(!this.contents[a]){n=!0;break}this[a]=this.contents[a]}return!(n||!o||!this.contents||!this.settings.contentsPath||(this.settings.bookKey=i,this.ready.manifest.resolve(this.manifest),this.ready.spine.resolve(this.spine),this.ready.metadata.resolve(this.metadata),this.ready.cover.resolve(this.cover),this.ready.toc.resolve(this.toc),0))},EPUBJS.Book.prototype.displayChapter=function(e,t,r){var n,i,o,s,a=this,c=r||new RSVP.defer;return this.isRendered?this._rendering||this.renderer._moving?(this._displayQ.enqueue("displayChapter",[e,t,c]),c.promise):(EPUBJS.core.isNumber(e)?o=e:(i=new EPUBJS.EpubCFI(e),o=i.spinePos),(o<0||o>=this.spine.length)&&(console.warn("Not A Valid Location"),o=0,t=!1,i=!1),s=new EPUBJS.Chapter(this.spine[o],this.store),this._rendering=!0,this._needsAssetReplacement()&&s.registerHook("beforeChapterRender",[EPUBJS.replace.head,EPUBJS.replace.resources,EPUBJS.replace.posters,EPUBJS.replace.svg],!0),a.currentChapter=s,n=a.renderer.displayChapter(s,this.globalLayoutProperties),i?a.renderer.gotoCfi(i):t&&a.renderer.lastPage(),n.then(function(e){a.spinePos=o,c.resolve(a.renderer),!1===a.settings.fromStorage&&!1===a.settings.contained&&a.preloadNextChapter(),a._rendering=!1,a._displayQ.dequeue(),0===a._displayQ.length()&&a._gotoQ.dequeue()},function(e){console.error("Could not load Chapter: "+s.absolute,e),a.trigger("book:chapterLoadFailed",s.absolute),a._rendering=!1,c.reject(e)}),c.promise):(this._q.enqueue("displayChapter",arguments),c.reject({message:"Rendering",stack:(new Error).stack}),c.promise)},EPUBJS.Book.prototype.nextPage=function(e){return e=e||new RSVP.defer,this.isRendered?this.renderer.nextPage()?(e.resolve(!0),e.promise):this.nextChapter(e):(this._q.enqueue("nextPage",[e]),e.promise)},EPUBJS.Book.prototype.prevPage=function(e){return e=e||new RSVP.defer,this.isRendered?this.renderer.prevPage()?(e.resolve(!0),e.promise):this.prevChapter(e):(this._q.enqueue("prevPage",[e]),e.promise)},EPUBJS.Book.prototype.nextChapter=function(e){if(e=e||new RSVP.defer,this.spinePos<this.spine.length-1){for(var t=this.spinePos+1;this.spine[t]&&this.spine[t].linear&&"no"==this.spine[t].linear;)t++;if(t<this.spine.length)return this.displayChapter(t,!1,e)}return this.trigger("book:atEnd"),e.resolve(!0),e.promise},EPUBJS.Book.prototype.prevChapter=function(e){if(e=e||new RSVP.defer,this.spinePos>0){for(var t=this.spinePos-1;this.spine[t]&&this.spine[t].linear&&"no"==this.spine[t].linear;)t--;if(t>=0)return this.displayChapter(t,!0,e)}return this.trigger("book:atStart"),e.resolve(!0),e.promise},EPUBJS.Book.prototype.getCurrentLocationCfi=function(){return!!this.isRendered&&this.renderer.currentLocationCfi},EPUBJS.Book.prototype.goto=function(e){return 0===e.indexOf("epubcfi(")?this.gotoCfi(e):e.indexOf("%")===e.length-1?this.gotoPercentage(parseInt(e.substring(0,e.length-1))/100):"number"==typeof e||!1===isNaN(e)?this.gotoPage(e):this.gotoHref(e)},EPUBJS.Book.prototype.gotoCfi=function(e,t){var r,n,i,o,s=t||new RSVP.defer;return this.isRendered?this._moving||this._rendering?(console.warn("Renderer is moving"),this._gotoQ.enqueue("gotoCfi",[e,s]),!1):-1!=(n=(r=new EPUBJS.EpubCFI(e)).spinePos)&&(i=this.spine[n],o=s.promise,this._moving=!0,this.currentChapter&&this.spinePos===n?(this.renderer.gotoCfi(r),this._moving=!1,s.resolve(this.renderer.currentLocationCfi)):(i&&-1!=n||(i=this.spine[n=0]),this.displayChapter(e).then((function(e){this._moving=!1,s.resolve(e.currentLocationCfi)}).bind(this),(function(){this._moving=!1}).bind(this))),o.then((function(){this._gotoQ.dequeue()}).bind(this)),o):(console.warn("Not yet Rendered"),this.settings.previousLocationCfi=e,!1)},EPUBJS.Book.prototype.gotoHref=function(e,t){var r,n,i,o,s,a=t||new RSVP.defer;return this.isRendered?this._moving||this._rendering?(this._gotoQ.enqueue("gotoHref",[e,a]),!1):(n=(r=e.split("#"))[0],i=r[1]||!1,o=-1==n.search("://")?n.replace(EPUBJS.core.uri(this.settings.contentsPath).path,""):n.replace(this.settings.contentsPath,""),s=this.spineIndexByURL[o],n||(s=this.currentChapter?this.currentChapter.spinePos:0),"number"==typeof s&&(this.currentChapter&&s==this.currentChapter.spinePos?(i?this.renderer.section(i):this.renderer.firstPage(),a.resolve(this.renderer.currentLocationCfi),a.promise.then((function(){this._gotoQ.dequeue()}).bind(this)),a.promise):this.displayChapter(s).then((function(){i&&this.renderer.section(i),a.resolve(this.renderer.currentLocationCfi)}).bind(this)))):(this.settings.goto=e,!1)},EPUBJS.Book.prototype.gotoPage=function(e){var t=this.pagination.cfiFromPage(e);return this.gotoCfi(t)},EPUBJS.Book.prototype.gotoPercentage=function(e){var t=this.pagination.pageFromPercentage(e);return this.gotoPage(t)},EPUBJS.Book.prototype.preloadNextChapter=function(){var e,t=this.spinePos+1;if(t>=this.spine.length)return!1;(e=new EPUBJS.Chapter(this.spine[t]))&&EPUBJS.core.request(e.absolute)},EPUBJS.Book.prototype.storeOffline=function(){var e=this,t=EPUBJS.core.values(this.manifest);return this.store.put(t).then(function(){e.settings.stored=!0,e.trigger("book:stored")})},EPUBJS.Book.prototype.availableOffline=function(){return this.settings.stored>0},EPUBJS.Book.prototype.toStorage=function(){var e=this.settings.bookKey;this.store.isStored(e).then((function(t){return!0===t?(this.settings.stored=!0,!0):this.storeOffline().then((function(){this.store.token(e,!0)}).bind(this))}).bind(this))},EPUBJS.Book.prototype.fromStorage=function(e){this.contained||this.settings.contained||(this.online&&this.opened.then(this.toStorage.bind(this)),this.store&&this.settings.fromStorage&&!1===e?(this.settings.fromStorage=!1,this.store.off("offline"),this.store=!1):this.settings.fromStorage||(this.store=new EPUBJS.Storage(this.settings.credentials),this.store.on("offline",(function(e){e?(this.offline=!0,this.settings.fromStorage=!0,this.trigger("book:offline")):(this.offline=!1,this.settings.fromStorage=!1,this.trigger("book:online"))}).bind(this))))},EPUBJS.Book.prototype.setStyle=function(e,t,r){if(!this.isRendered)return this._q.enqueue("setStyle",arguments);this.settings.styles[e]=t,this.renderer.setStyle(e,t,r),-1===["color","background","background-color"].indexOf(e)&&this.renderer.reformat()},EPUBJS.Book.prototype.removeStyle=function(e){if(!this.isRendered)return this._q.enqueue("removeStyle",arguments);this.renderer.removeStyle(e),this.renderer.reformat(),delete this.settings.styles[e]},EPUBJS.Book.prototype.resetClasses=function(e){if(!this.isRendered)return this._q.enqueue("setClasses",arguments);e.constructor===String&&(e=[e]),this.settings.classes=e,this.renderer.setClasses(this.settings.classes),this.renderer.reformat()},EPUBJS.Book.prototype.addClass=function(e){if(!this.isRendered)return this._q.enqueue("addClass",arguments);-1==this.settings.classes.indexOf(e)&&this.settings.classes.push(e),this.renderer.setClasses(this.settings.classes),this.renderer.reformat()},EPUBJS.Book.prototype.removeClass=function(e){if(!this.isRendered)return this._q.enqueue("removeClass",arguments);var t=this.settings.classes.indexOf(e);-1!=t&&(delete this.settings.classes[t],this.renderer.setClasses(this.settings.classes),this.renderer.reformat())},EPUBJS.Book.prototype.addHeadTag=function(e,t){if(!this.isRendered)return this._q.enqueue("addHeadTag",arguments);this.settings.headTags[e]=t},EPUBJS.Book.prototype.useSpreads=function(e){console.warn("useSpreads is deprecated, use forceSingle or set a layoutOveride instead"),this.forceSingle(!1===e)},EPUBJS.Book.prototype.forceSingle=function(e){var t="undefined"==typeof e||e;this.renderer.forceSingle(t),this.settings.forceSingle=t,this.isRendered&&this.renderer.reformat()},EPUBJS.Book.prototype.setMinSpreadWidth=function(e){this.settings.minSpreadWidth=e,this.isRendered&&(this.renderer.setMinSpreadWidth(this.settings.minSpreadWidth),this.renderer.reformat())},EPUBJS.Book.prototype.setGap=function(e){this.settings.gap=e,this.isRendered&&(this.renderer.setGap(this.settings.gap),this.renderer.reformat())},EPUBJS.Book.prototype.chapter=function(e){var t,r=this.spineIndexByURL[e];return r&&(t=new EPUBJS.Chapter(this.spine[r],this.store,this.settings.withCredentials)).load(),t},EPUBJS.Book.prototype.unload=function(){this.settings.restore&&localStorage&&this.saveContents(),this.unlistenToRenderer(this.renderer),this.trigger("book:unload")},EPUBJS.Book.prototype.destroy=function(){window.removeEventListener("beforeunload",this.unload),this.currentChapter&&this.currentChapter.unload(),this.unload(),this.renderer&&this.renderer.remove()},EPUBJS.Book.prototype._ready=function(){this.trigger("book:ready")},EPUBJS.Book.prototype._rendered=function(e){this.isRendered=!0,this.trigger("book:rendered"),this._q.flush()},EPUBJS.Book.prototype.applyStyles=function(e,t){e.applyStyles(this.settings.styles),t()},EPUBJS.Book.prototype.applyClasses=function(e,t){e.setClasses(this.settings.classes),t()},EPUBJS.Book.prototype.applyHeadTags=function(e,t){e.applyHeadTags(this.settings.headTags),t()},EPUBJS.Book.prototype._registerReplacements=function(e){e.registerHook("beforeChapterDisplay",this.applyStyles.bind(this,e),!0),e.registerHook("beforeChapterDisplay",this.applyHeadTags.bind(this,e),!0),e.registerHook("beforeChapterDisplay",this.applyClasses.bind(this,e),!0),e.registerHook("beforeChapterDisplay",EPUBJS.replace.hrefs.bind(this),!0)},EPUBJS.Book.prototype._needsAssetReplacement=function(){return!!this.settings.fromStorage||!!this.settings.contained},EPUBJS.Book.prototype.parseLayoutProperties=function(e){return{layout:this.settings.layoutOveride&&this.settings.layoutOveride.layout||e.layout||"reflowable",spread:this.settings.layoutOveride&&this.settings.layoutOveride.spread||e.spread||"auto",orientation:this.settings.layoutOveride&&this.settings.layoutOveride.orientation||e.orientation||"auto"}},RSVP.EventTarget.mixin(EPUBJS.Book.prototype),RSVP.on("error",function(e){console.error(e)}),RSVP.configure("instrument",!0),EPUBJS.Chapter=function(e,t,r){this.href=e.href,this.absolute=e.url,this.id=e.id,this.spinePos=e.index,this.cfiBase=e.cfiBase,this.properties=e.properties,this.manifestProperties=e.manifestProperties,this.linear=e.linear,this.pages=1,this.store=t,this.credentials=r,this.epubcfi=new EPUBJS.EpubCFI,this.deferred=new RSVP.defer,this.loaded=this.deferred.promise,EPUBJS.Hooks.mixin(this),this.getHooks("beforeChapterRender"),this.caches={}},EPUBJS.Chapter.prototype.load=function(e,t){var r,n=e||this.store,i=t||this.credentials;return(r=n?n.getXml(this.absolute):EPUBJS.core.request(this.absolute,!1,i)).then((function(e){try{this.setDocument(e),this.deferred.resolve(this)}catch(e){this.deferred.reject({message:this.absolute+" -> "+e.message,stack:(new Error).stack})}}).bind(this)),r},EPUBJS.Chapter.prototype.render=function(e){return this.load().then((function(e){var t=e.querySelector("head"),r=e.createElement("base");return r.setAttribute("href",this.absolute),t.insertBefore(r,t.firstChild),this.contents=e,new RSVP.Promise((function(t,r){this.triggerHooks("beforeChapterRender",(function(){t(e)}).bind(this),this)}).bind(this))}).bind(this)).then((function(e){return(new XMLSerializer).serializeToString(e)}).bind(this))},EPUBJS.Chapter.prototype.url=function(e){var t=new RSVP.defer,r=e||this.store,n=this;return r?this.tempUrl?t.resolve(this.tempUrl):r.getUrl(this.absolute).then(function(e){n.tempUrl=e,t.resolve(e)}):t.resolve(this.absolute),t.promise},EPUBJS.Chapter.prototype.setPages=function(e){this.pages=e},EPUBJS.Chapter.prototype.getPages=function(e){return this.pages},EPUBJS.Chapter.prototype.getID=function(){return this.ID},EPUBJS.Chapter.prototype.unload=function(e){this.document=null,this.tempUrl&&e&&(e.revokeUrl(this.tempUrl),this.tempUrl=!1)},EPUBJS.Chapter.prototype.setDocument=function(e){this.document=e,this.contents=e.documentElement,!this.document.evaluate&&document.evaluate&&(this.document.evaluate=document.evaluate)},EPUBJS.Chapter.prototype.cfiFromRange=function(e){var t,r,n,i,o,s,a;if(this.document){if("undefined"!=typeof document.evaluate){if(r=EPUBJS.core.getElementXPath(e.startContainer),n=EPUBJS.core.getElementXPath(e.endContainer),i=this.document.evaluate(r,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,e.collapsed||(o=this.document.evaluate(n,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),t=this.document.createRange(),i)try{t.setStart(i,e.startOffset),!e.collapsed&&o&&t.setEnd(o,e.endOffset)}catch(e){console.log("missed"),i=!1}i||(console.log("not found, try fuzzy match"),s=EPUBJS.core.cleanStringForXpath(e.startContainer.textContent),(i=this.document.evaluate(r="//text()[contains(.,"+s+")]",this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)&&(t.setStart(i,e.startOffset),e.collapsed||(a=EPUBJS.core.cleanStringForXpath(e.endContainer.textContent),(o=this.document.evaluate(n="//text()[contains(.,"+a+")]",this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)&&t.setEnd(o,e.endOffset))))}else t=e;return this.epubcfi.generateCfiFromRange(t,this.cfiBase)}},EPUBJS.Chapter.prototype.find=function(e){var t=this,r=[],n=e.toLowerCase();return this.textSprint(this.document,function(e){!function(e){for(var i,o,s,a=e.textContent.toLowerCase(),c=t.document.createRange(),h=-1;-1!=o;)-1!=(o=a.indexOf(n,h+1))&&((c=t.document.createRange()).setStart(e,o),c.setEnd(e,o+n.length),i=t.cfiFromRange(c),s=e.textContent.length<150?e.textContent:"..."+(s=e.textContent.substring(o-75,o+75))+"...",r.push({cfi:i,excerpt:s})),h=o}(e)}),r},EPUBJS.Chapter.prototype.textSprint=function(e,t){for(var r,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return e.data&&!/^\s*$/.test(e.data)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1);r=n.nextNode();)t(r)},EPUBJS.Chapter.prototype.replace=function(e,t,r,n){var i=this.contents.querySelectorAll(e),o=Array.prototype.slice.call(i),s=o.length;0!==s?o.forEach((function(e){var i=!1;t(e,function(e,t){!1===i&&(s--,n&&n(e,t,s),s<=0&&r&&r(!0),i=!0)})}).bind(this)):r(!1)},EPUBJS.Chapter.prototype.replaceWithStored=function(e,t,r,n){var i,o={},s=this.store,a=this.caches[e],c=EPUBJS.core.uri(this.absolute).base,h=t;s&&(a||(a={}),i=EPUBJS.core.clone(a),this.replace(e,function(t,n){var a=t.getAttribute(h),u=EPUBJS.core.resolveUrl(c,a),l=function(r){var i;t.onload=function(){clearTimeout(i),n(r,u)},"svg image"==e&&t.setAttribute("externalResourcesRequired","true"),"link[href]"==e&&"stylesheet"!==t.getAttribute("rel")?n(r,u):i=setTimeout(function(){n(r,u)},5),r&&t.setAttribute(h,r)};u in i?(l(i[u]),o[u]=i[u],delete i[u]):r(s,u,l,t)},function(e){n&&n(),EPUBJS.core.values(i).forEach(function(e){s.revokeUrl(e)}),a=o},function(e,t,r){o[t]=e}))},(EPUBJS=EPUBJS||{}).core={};var EPUBJS,ELEMENT_NODE=1,TEXT_NODE=3,COMMENT_NODE=8,DOCUMENT_NODE=9;EPUBJS.core.getEl=function(e){return document.getElementById(e)},EPUBJS.core.getEls=function(e){return document.getElementsByClassName(e)},EPUBJS.core.request=function(e,t,r){var n,i=window.URL,o=i?"blob":"arraybuffer",s=new RSVP.defer,a=new XMLHttpRequest,c=XMLHttpRequest.prototype;return"overrideMimeType"in c||Object.defineProperty(c,"overrideMimeType",{value:function(e){}}),a.onreadystatechange=function(){var e;this.readyState==this.DONE&&(200!==this.status&&0!==this.status||!this.response?s.reject({message:this.response,stack:(new Error).stack}):(e="xml"==t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"application/xml"):"xhtml"==t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"application/xhtml+xml"):"html"==t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"text/html"):"json"==t?JSON.parse(this.response):"blob"==t?i?this.response:new Blob([this.response]):this.response,s.resolve(e)))},a.open("GET",e,!0),r&&(a.withCredentials=!0),t||(n=EPUBJS.core.uri(e),t={htm:"html"}[t=n.extension]||t),"blob"==t&&(a.responseType=o),"json"==t&&a.setRequestHeader("Accept","application/json"),"xml"==t&&(a.responseType="document",a.overrideMimeType("text/xml")),"xhtml"==t&&(a.responseType="document"),"html"==t&&(a.responseType="document"),"binary"==t&&(a.responseType="arraybuffer"),a.send(),s.promise},EPUBJS.core.toArray=function(e){var t=[];for(var r in e){var n;e.hasOwnProperty(r)&&((n=e[r]).ident=r,t.push(n))}return t},EPUBJS.core.uri=function(e){var t,r,n,i={protocol:"",host:"",path:"",origin:"",directory:"",base:"",filename:"",extension:"",fragment:"",href:e},o=e.indexOf("blob:"),s=e.indexOf("://"),a=e.indexOf("?"),c=e.indexOf("#");return 0===o?(i.protocol="blob",i.base=e.indexOf(0,c),i):(-1!=c&&(i.fragment=e.slice(c+1),e=e.slice(0,c)),-1!=a&&(i.search=e.slice(a+1),e=e.slice(0,a),href=i.href),-1!=s?(i.protocol=e.slice(0,s),-1===(n=(t=e.slice(s+3)).indexOf("/"))?(i.host=i.path,i.path=""):(i.host=t.slice(0,n),i.path=t.slice(n)),i.origin=i.protocol+"://"+i.host,i.directory=EPUBJS.core.folder(i.path),i.base=i.origin+i.directory):(i.path=e,i.directory=EPUBJS.core.folder(e),i.base=i.directory),i.filename=e.replace(i.base,""),-1!=(r=i.filename.lastIndexOf("."))&&(i.extension=i.filename.slice(r+1)),i)},EPUBJS.core.folder=function(e){var t=e.lastIndexOf("/");return e.slice(0,t+1)},EPUBJS.core.dataURLToBlob=function(e){var t,r,n,i,o;if(-1==e.indexOf(";base64,"))return r=(t=e.split(","))[0].split(":")[1],n=t[1],new Blob([n],{type:r});r=(t=e.split(";base64,"))[0].split(":")[1],i=(n=window.atob(t[1])).length,o=new Uint8Array(i);for(var s=0;s<i;++s)o[s]=n.charCodeAt(s);return new Blob([o],{type:r})},EPUBJS.core.addScript=function(e,t,r){var n,i;i=!1,(n=document.createElement("script")).type="text/javascript",n.async=!1,n.src=e,n.onload=n.onreadystatechange=function(){i||this.readyState&&"complete"!=this.readyState||(i=!0,t&&t())},(r=r||document.body).appendChild(n)},EPUBJS.core.addScripts=function(e,t,r){var n=e.length,i=0,o=function(){n==++i?t&&t():EPUBJS.core.addScript(e[i],o,r)};EPUBJS.core.addScript(e[i],o,r)},EPUBJS.core.addCss=function(e,t,r){var n,i;i=!1,(n=document.createElement("link")).type="text/css",n.rel="stylesheet",n.href=e,n.onload=n.onreadystatechange=function(){i||this.readyState&&"complete"!=this.readyState||(i=!0,t&&t())},(r=r||document.body).appendChild(n)},EPUBJS.core.prefixed=function(e){var t=["Webkit","Moz","O","ms"],r=e[0].toUpperCase()+e.slice(1),n=t.length;if("undefined"!=typeof document.documentElement.style[e])return e;for(var i=0;i<n;i++)if("undefined"!=typeof document.documentElement.style[t[i]+r])return t[i]+r;return e},EPUBJS.core.resolveUrl=function(e,t){var r=[],n=EPUBJS.core.uri(t),i=e.split("/");return n.host?t:(i.pop(),t.split("/").forEach(function(e){".."===e?i.pop():r.push(e)}),i.concat(r).join("/"))},EPUBJS.core.uuid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:7&r|8).toString(16)})},EPUBJS.core.insert=function(e,t,r){var n=EPUBJS.core.locationOf(e,t,r);return t.splice(n,0,e),n},EPUBJS.core.locationOf=function(e,t,r,n,i){var o,s=n||0,a=i||t.length,c=parseInt(s+(a-s)/2);return r||(r=function(e,t){return e>t?1:e<t?-1:(e=t)?0:void 0}),a-s<=0?c:(o=r(t[c],e),a-s==1?o>0?c:c+1:0===o?c:-1===o?EPUBJS.core.locationOf(e,t,r,c,a):EPUBJS.core.locationOf(e,t,r,s,c))},EPUBJS.core.indexOfSorted=function(e,t,r,n,i){var o,s=n||0,a=i||t.length,c=parseInt(s+(a-s)/2);return r||(r=function(e,t){return e>t?1:e<t?-1:(e=t)?0:void 0}),a-s<=0?-1:(o=r(t[c],e),a-s==1?0===o?c:-1:0===o?c:-1===o?EPUBJS.core.indexOfSorted(e,t,r,c,a):EPUBJS.core.indexOfSorted(e,t,r,s,c))},EPUBJS.core.queue=function(e){var t=[],r=e,n=function(){var e;t.length&&(e=t.shift(),r[e.funcName].apply(e.context||r,e.args))};return{enqueue:function(e,r,n){return t.push({funcName:e,args:r,context:n}),t},dequeue:n,flush:function(){for(;t.length;)n()},clear:function(){t=[]},length:function(){return t.length}}},EPUBJS.core.getElementXPath=function(e){return e&&e.id?'//*[@id="'+e.id+'"]':EPUBJS.core.getElementTreeXPath(e)},EPUBJS.core.getElementTreeXPath=function(e){var t,r,n=[],i="http://www.w3.org/1999/xhtml"===e.ownerDocument.documentElement.getAttribute("xmlns");for(e.nodeType===Node.TEXT_NODE&&(t=EPUBJS.core.indexOfTextNode(e)+1,n.push("text()["+t+"]"),e=e.parentNode);e&&1==e.nodeType;e=e.parentNode){t=0;for(var o=e.previousSibling;o;o=o.previousSibling)o.nodeType!=Node.DOCUMENT_TYPE_NODE&&o.nodeName==e.nodeName&&++t;r=e.nodeName.toLowerCase(),n.splice(0,0,(i?"xhtml:"+r:r)+(t?"["+(t+1)+"]":""))}return n.length?"./"+n.join("/"):null},EPUBJS.core.nsResolver=function(e){return{xhtml:"http://www.w3.org/1999/xhtml",epub:"http://www.idpf.org/2007/ops"}[e]||null},EPUBJS.core.cleanStringForXpath=function(e){var t=e.match(/[^'"]+|['"]/g);return"concat('',"+(t=t.map(function(e){return"'"===e?'"\'"':'"'===e?"'\"'":"'"+e+"'"})).join(",")+")"},EPUBJS.core.indexOfTextNode=function(e){for(var t,r=e.parentNode.childNodes,n=-1,i=0;i<r.length&&((t=r[i]).nodeType===Node.TEXT_NODE&&n++,t!=e);i++);return n},EPUBJS.core.defaults=function(e){for(var t=1,r=arguments.length;t<r;t++){var n=arguments[t];for(var i in n)void 0===e[i]&&(e[i]=n[i])}return e},EPUBJS.core.extend=function(e){return[].slice.call(arguments,1).forEach(function(t){t&&Object.getOwnPropertyNames(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}),e},EPUBJS.core.clone=function(e){return EPUBJS.core.isArray(e)?e.slice():EPUBJS.core.extend({},e)},EPUBJS.core.isElement=function(e){return!(!e||1!=e.nodeType)},EPUBJS.core.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},EPUBJS.core.isString=function(e){return"string"==typeof e||e instanceof String},EPUBJS.core.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},EPUBJS.core.values=function(e){var t,r,n,i=-1;if(!e)return[];for(r=(t=Object.keys(e)).length,n=Array(r);++i<r;)n[i]=e[t[i]];return n},EPUBJS.core.indexOfNode=function(e,t){for(var r,n=e.parentNode.childNodes,i=-1,o=0;o<n.length&&((r=n[o]).nodeType===t&&i++,r!=e);o++);return i},EPUBJS.core.indexOfTextNode=function(e){return EPUBJS.core.indexOfNode(e,TEXT_NODE)},EPUBJS.core.indexOfElementNode=function(e){return EPUBJS.core.indexOfNode(e,ELEMENT_NODE)},EPUBJS.EpubCFI=function(e){if(e)return this.parse(e)},EPUBJS.EpubCFI.prototype.generateChapterComponent=function(e,t,r){var n="/"+2*(e+1)+"/";return n+=2*(parseInt(t)+1),r&&(n+="["+r+"]"),n},EPUBJS.EpubCFI.prototype.generatePathComponent=function(e){return e.map(function(e){return 2*(e.index+1)+(e.id?"["+e.id+"]":"")}).join("/")},EPUBJS.EpubCFI.prototype.generateCfiFromElement=function(e,t){var r=this.pathTo(e),n=this.generatePathComponent(r);return n.length?"epubcfi("+t+"!/"+n+"/1:0)":"epubcfi("+t+"!/4/)"},EPUBJS.EpubCFI.prototype.pathTo=function(e){for(var t,r=[];e&&null!==e.parentNode&&9!=e.parentNode.nodeType;)r.unshift({id:e.id,tagName:e.tagName,index:(t=e.parentNode.children)?Array.prototype.indexOf.call(t,e):0}),e=e.parentNode;return r},EPUBJS.EpubCFI.prototype.getChapterComponent=function(e){return e.split("!")[0]},EPUBJS.EpubCFI.prototype.getPathComponent=function(e){var t=e.split("!");return(t[1]?t[1].split(":"):"")[0]},EPUBJS.EpubCFI.prototype.getCharecterOffsetComponent=EPUBJS.EpubCFI.prototype.getCharacterOffsetComponent=function(e){return e.split(":")[1]||""},EPUBJS.EpubCFI.prototype.parse=function(e){var t,r,n,i,o,s,a,c,h,u={},l=function(e){var t,r,n;return t=parseInt(e)/2-1,(r=e.match(/\[(.*)\]/))&&r[1]&&(n=r[1]),{type:"element",index:t,id:n||!1}};return"string"!=typeof e?{spinePos:-1}:(u.str=e,0===e.indexOf("epubcfi(")&&")"===e[e.length-1]&&(e=e.slice(8,e.length-1)),r=this.getChapterComponent(e),n=this.getPathComponent(e)||"",i=this.getCharacterOffsetComponent(e),r&&(t=r.split("/")[2]||"")?(u.spinePos=parseInt(t)/2-1||0,s=t.match(/\[(.*)\]/),u.spineId=!!s&&s[1],-1!=n.indexOf(",")&&console.warn("CFI Ranges are not supported"),c=(a=n.split("/")).pop(),u.steps=[],a.forEach(function(e){var t;e&&(t=l(e),u.steps.push(t))}),h=parseInt(c),isNaN(h)||u.steps.push(h%2==0?l(c):{type:"text",index:(h-1)/2}),(o=i.match(/\[(.*)\]/))&&o[1]?(u.characterOffset=parseInt(i.split("[")[0]),u.textLocationAssertion=o[1]):u.characterOffset=parseInt(i),u):{spinePos:-1})},EPUBJS.EpubCFI.prototype.addMarker=function(e,t,r){var n,i,o,s,a=t||document,c=r||this.createMarker(a);return"string"==typeof e&&(e=this.parse(e)),i=e.steps[e.steps.length-1],-1!==e.spinePos&&!!(n=this.findParent(e,a))&&(i&&"text"===i.type?(o=n.childNodes[i.index],e.characterOffset?(s=o.splitText(e.characterOffset),c.classList.add("EPUBJS-CFI-SPLIT"),n.insertBefore(c,s)):n.insertBefore(c,o)):n.insertBefore(c,n.firstChild),c)},EPUBJS.EpubCFI.prototype.createMarker=function(e){var t=(e||document).createElement("span");return t.id="EPUBJS-CFI-MARKER:"+EPUBJS.core.uuid(),t.classList.add("EPUBJS-CFI-MARKER"),t},EPUBJS.EpubCFI.prototype.removeMarker=function(e,t){t||document,e.classList.contains("EPUBJS-CFI-SPLIT")?(nextSib=e.nextSibling,prevSib=e.previousSibling,nextSib&&prevSib&&3===nextSib.nodeType&&3===prevSib.nodeType&&(prevSib.textContent+=nextSib.textContent,e.parentNode.removeChild(nextSib)),e.parentNode.removeChild(e)):e.classList.contains("EPUBJS-CFI-MARKER")&&e.parentNode.removeChild(e)},EPUBJS.EpubCFI.prototype.findParent=function(e,t){var r,n,i=t||document,o=i.getElementsByTagName("html")[0],s=Array.prototype.slice.call(o.children);if("string"==typeof e&&(e=this.parse(e)),!(n=e.steps.slice(0)).length)return i.getElementsByTagName("body")[0];for(;n&&n.length>0;){if(!(o="text"===(r=n.shift()).type?o.childNodes[r.index].parentNode||o:r.id?i.getElementById(r.id):s[r.index])||"undefined"==typeof o)return console.error("No Element For",r,e.str),!1;s=Array.prototype.slice.call(o.children)}return o},EPUBJS.EpubCFI.prototype.compare=function(e,t){if("string"==typeof e&&(e=new EPUBJS.EpubCFI(e)),"string"==typeof t&&(t=new EPUBJS.EpubCFI(t)),e.spinePos>t.spinePos)return 1;if(e.spinePos<t.spinePos)return-1;for(var r=0;r<e.steps.length;r++){if(!t.steps[r])return 1;if(e.steps[r].index>t.steps[r].index)return 1;if(e.steps[r].index<t.steps[r].index)return-1}return e.steps.length<t.steps.length?-1:e.characterOffset>t.characterOffset?1:e.characterOffset<t.characterOffset?-1:0},EPUBJS.EpubCFI.prototype.generateCfiFromHref=function(e,t){var r,n=EPUBJS.core.uri(e),i=n.fragment,o=t.spineIndexByURL[n.path],s=new RSVP.defer,a=new EPUBJS.EpubCFI;return"undefined"!=typeof o&&t.loadXml((r=t.spine[o]).url).then(function(e){var t,n=e.getElementById(i);t=a.generateCfiFromElement(n,r.cfiBase),s.resolve(t)}),s.promise},EPUBJS.EpubCFI.prototype.generateCfiFromTextNode=function(e,t,r){var n=e.parentNode,i=this.pathTo(n);return"epubcfi("+r+"!/"+this.generatePathComponent(i)+"/"+(1+2*Array.prototype.indexOf.call(n.childNodes,e))+":"+(t||0)+")"},EPUBJS.EpubCFI.prototype.generateCfiFromRangeAnchor=function(e,t){return this.generateCfiFromTextNode(e.anchorNode,e.anchorOffset,t)},EPUBJS.EpubCFI.prototype.generateCfiFromRange=function(e,t){var r,n,i,o,s,a,c,h,u,l,d,f;if(3===(r=e.startContainer).nodeType)n=r.parentNode,a=1+2*EPUBJS.core.indexOfTextNode(r),i=this.pathTo(n);else{if(e.collapsed)return this.generateCfiFromElement(r,t);i=this.pathTo(r)}return o=this.generatePathComponent(i),s=e.startOffset,e.collapsed?"epubcfi("+t+"!/"+o+"/"+a+":"+s+")":(3===(c=e.endContainer).nodeType?(h=c.parentNode,f=1+2*EPUBJS.core.indexOfTextNode(c),u=this.pathTo(h)):u=this.pathTo(c),l=this.generatePathComponent(u),d=e.endOffset,(l=l.replace(o,"")).length&&(l+="/"),"epubcfi("+t+"!/"+o+"/"+a+":"+s+","+l+f+":"+d+")")},EPUBJS.EpubCFI.prototype.generateXpathFromSteps=function(e){var t=[".","*"];return e.forEach(function(e){var r=e.index+1;t.push(e.id?"*[position()="+r+" and @id='"+e.id+"']":"text"===e.type?"text()["+r+"]":"*["+r+"]")}),t.join("/")},EPUBJS.EpubCFI.prototype.generateQueryFromSteps=function(e){var t=["html"];return e.forEach(function(e){var r=e.index+1;e.id?t.push("#"+e.id):"text"===e.type||t.push("*:nth-child("+r+")")}),t.join(">")},EPUBJS.EpubCFI.prototype.generateRangeFromCfi=function(e,t){var r,n,i,o,s,a,c=t||document,h=c.createRange();return"string"==typeof e&&(e=this.parse(e)),-1!==e.spinePos&&(r=e.steps[e.steps.length-1],"undefined"!=typeof document.evaluate?(n=this.generateXpathFromSteps(e.steps),i=c.evaluate(n,c,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue):(s=this.generateQueryFromSteps(e.steps),(a=c.querySelector(s))&&"text"==r.type&&(i=a.childNodes[r.index])),i?(i&&e.characterOffset>=0?e.characterOffset<(o=i.length)?(h.setStart(i,e.characterOffset),h.setEnd(i,o)):(console.debug("offset greater than length:",e.characterOffset,o),h.setStart(i,o-1),h.setEnd(i,o)):i&&h.selectNode(i),h):null)},EPUBJS.EpubCFI.prototype.isCfiString=function(e){return"string"==typeof e&&0===e.indexOf("epubcfi(")},EPUBJS.Events=function(e,t){return this.events={},this.el=t||document.createElement("div"),e.createEvent=this.createEvent,e.tell=this.tell,e.listen=this.listen,e.deafen=this.deafen,e.listenUntil=this.listenUntil,this},EPUBJS.Events.prototype.createEvent=function(e){var t=new CustomEvent(e);return this.events[e]=t,t},EPUBJS.Events.prototype.tell=function(e,t){var r;this.events[e]?r=this.events[e]:(console.warn("No event:",e,"defined yet, creating."),r=this.createEvent(e)),t&&(r.msg=t),this.el.dispatchEvent(r)},EPUBJS.Events.prototype.listen=function(e,t,r){if(!this.events[e])return console.warn("No event:",e,"defined yet, creating."),void this.createEvent(e);this.el.addEventListener(e,r?t.bind(r):t,!1)},EPUBJS.Events.prototype.deafen=function(e,t){this.el.removeEventListener(e,t,!1)},EPUBJS.Events.prototype.listenUntil=function(e,t,r,n){this.listen(e,r,n),this.listen(t,function n(){this.deafen(e,r),this.deafen(t,n)},this)},EPUBJS.hooks={},EPUBJS.Hooks=function(){function e(){}return e.prototype.getHooks=function(){for(var e in this.hooks={},Array.prototype.slice.call(arguments).forEach(function(e){this.hooks[e]=[]},this),this.hooks)EPUBJS.core.values(EPUBJS.hooks[e]).forEach(function(t){this.registerHook(e,t)},this)},e.prototype.registerHook=function(e,t,r){"undefined"!=typeof this.hooks[e]?"function"==typeof t?r?this.hooks[e].unshift(t):this.hooks[e].push(t):Array.isArray(t)&&t.forEach(function(t){r?this.hooks[e].unshift(t):this.hooks[e].push(t)},this):(this.hooks[e]=[t],"function"==typeof t?this.hooks[e]=[t]:Array.isArray(t)&&(this.hooks[e]=[],t.forEach(function(t){this.hooks[e].push(t)},this)))},e.prototype.removeHook=function(e,t){var r;"undefined"!=typeof this.hooks[e]&&("function"==typeof t?(r=this.hooks[e].indexOf(t))>-1&&this.hooks[e].splice(r,1):Array.isArray(t)&&t.forEach(function(t){(r=this.hooks[e].indexOf(t))>-1&&this.hooks[e].splice(r,1)},this))},e.prototype.triggerHooks=function(e,t,r){var n,i;if("undefined"==typeof this.hooks[e])return!1;function o(){--i<=0&&t&&t()}0===(i=(n=this.hooks[e]).length)&&t&&t(),n.forEach(function(e){e(o,r)})},{register:function(e){if(void 0===EPUBJS.hooks[e]&&(EPUBJS.hooks[e]={}),"object"!=typeof EPUBJS.hooks[e])throw"Already registered: "+e;return EPUBJS.hooks[e]},mixin:function(t){for(var r in e.prototype)t[r]=e.prototype[r]}}}(),EPUBJS.Layout=EPUBJS.Layout||{},EPUBJS.Layout.isFixedLayout=function(e){var t=e.querySelector("[name=viewport]");if(!t||!t.hasAttribute("content"))return!1;var r=t.getAttribute("content");return/width=(\d+)/.test(r)&&/height=(\d+)/.test(r)},EPUBJS.Layout.Reflowable=function(){this.documentElement=null,this.spreadWidth=null},EPUBJS.Layout.Reflowable.prototype.format=function(e,t,r,n){var i=EPUBJS.core.prefixed("columnAxis"),o=EPUBJS.core.prefixed("columnGap"),s=EPUBJS.core.prefixed("columnWidth"),a=EPUBJS.core.prefixed("columnFill"),c=Math.floor(t),h=Math.floor(c/8),u=n>=0?n:h%2==0?h:h-1;return this.documentElement=e,this.spreadWidth=c+u,e.style.overflow="hidden",e.style.width=c+"px",e.style.height=r+"px",e.style[i]="horizontal",e.style[a]="auto",e.style[s]=c+"px",e.style[o]=u+"px",this.colWidth=c,this.gap=u,{pageWidth:this.spreadWidth,pageHeight:r}},EPUBJS.Layout.Reflowable.prototype.calculatePages=function(){var e;return this.documentElement.style.width="auto",{displayedPages:e=Math.ceil(this.documentElement.scrollWidth/this.spreadWidth),pageCount:e}},EPUBJS.Layout.ReflowableSpreads=function(){this.documentElement=null,this.spreadWidth=null},EPUBJS.Layout.ReflowableSpreads.prototype.format=function(e,t,r,n){var i=EPUBJS.core.prefixed("columnAxis"),o=EPUBJS.core.prefixed("columnGap"),s=EPUBJS.core.prefixed("columnWidth"),a=EPUBJS.core.prefixed("columnFill"),c=Math.floor(t),h=c%2==0?c:c-1,u=Math.floor(h/8),l=n>=0?n:u%2==0?u:u-1,d=Math.floor((h-l)/2);return this.documentElement=e,this.spreadWidth=2*(d+l),e.style.overflow="hidden",e.style.width=h+"px",e.style.height=r+"px",e.style[i]="horizontal",e.style[a]="auto",e.style[o]=l+"px",e.style[s]=d+"px",this.colWidth=d,this.gap=l,{pageWidth:this.spreadWidth,pageHeight:r}},EPUBJS.Layout.ReflowableSpreads.prototype.calculatePages=function(){var e=Math.ceil(this.documentElement.scrollWidth/this.spreadWidth);return this.documentElement.style.width=e*this.spreadWidth-this.gap+"px",{displayedPages:e,pageCount:2*e}},EPUBJS.Layout.Fixed=function(){this.documentElement=null},EPUBJS.Layout.Fixed.prototype.format=function(e,t,r,n){var i,o,s,a=EPUBJS.core.prefixed("columnWidth"),c=EPUBJS.core.prefixed("transform"),h=EPUBJS.core.prefixed("transformOrigin"),u=e.querySelector("[name=viewport]");this.documentElement=e,u&&u.hasAttribute("content")&&((i=u.getAttribute("content").split(","))[0]&&(o=i[0].replace("width=","")),i[1]&&(s=i[1].replace("height=","")));var l=t/o,d=r/s,f=l<d?l:d;return e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style[c]="scale("+f+") translate(-50%, -50%)",e.style[h]="0px 0px 0px",e.style.width=o+"px"||"auto",e.style.height=s+"px"||"auto",e.style[a]="auto",e.style.overflow="auto",this.colWidth=o,this.gap=0,{pageWidth:o,pageHeight:s}},EPUBJS.Layout.Fixed.prototype.calculatePages=function(){return{displayedPages:1,pageCount:1}},EPUBJS.Locations=function(e,t,r){this.spine=e,this.store=t,this.credentials=r,this.epubcfi=new EPUBJS.EpubCFI,this._locations=[],this.total=0,this.break=150,this._current=0},EPUBJS.Locations.prototype.generate=function(e){var t=new RSVP.defer,r=-1,n=this.spine.length,i=(function(e){var t,o=r+1,s=e||new RSVP.defer;return o>=n?s.resolve():(t=new EPUBJS.Chapter(this.spine[r=o],this.store,this.credentials),this.process(t).then(function(){setTimeout(function(){i(s)},1)})),s.promise}).bind(this);return"number"==typeof e&&(this.break=e),i().then((function(){this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),t.resolve(this._locations)}).bind(this)),t.promise},EPUBJS.Locations.prototype.process=function(e){return e.load().then((function(t){var r,n,i,o=t,s=o.documentElement.querySelector("body"),a=0,c=this.break;this.sprint(s,(function(t){var s,h=t.length,u=0;if(0===t.textContent.trim().length)return!1;for(0===a&&(r=o.createRange()).setStart(t,0),(s=c-a)>h&&(a+=h,u=h);u<h;)s=c-a,0===a&&(u+=1,(r=o.createRange()).setStart(t,u)),u+s>=h?(a+=h-u,u=h):(r.setEnd(t,u+=s),i=e.cfiFromRange(r),this._locations.push(i),a=0);n=t}).bind(this)),r&&(r.setEnd(n,n.length),i=e.cfiFromRange(r),this._locations.push(i),a=0)}).bind(this))},EPUBJS.Locations.prototype.sprint=function(e,t){for(var r,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);r=n.nextNode();)t(r)},EPUBJS.Locations.prototype.locationFromCfi=function(e){return 0===this._locations.length?-1:EPUBJS.core.locationOf(e,this._locations,this.epubcfi.compare)},EPUBJS.Locations.prototype.percentageFromCfi=function(e){var t=this.locationFromCfi(e);return this.percentageFromLocation(t)},EPUBJS.Locations.prototype.percentageFromLocation=function(e){return e&&this.total?e/this.total:0},EPUBJS.Locations.prototype.cfiFromLocation=function(e){var t=-1;return"number"!=typeof e&&(e=parseInt(e)),e>=0&&e<this._locations.length&&(t=this._locations[e]),t},EPUBJS.Locations.prototype.cfiFromPercentage=function(e){var t=Math.ceil(this.total*(e>1?e/100:e));return this.cfiFromLocation(t)},EPUBJS.Locations.prototype.load=function(e){return this._locations=JSON.parse(e),this.total=this._locations.length-1,this._locations},EPUBJS.Locations.prototype.save=function(e){return JSON.stringify(this._locations)},EPUBJS.Locations.prototype.getCurrent=function(e){return this._current},EPUBJS.Locations.prototype.setCurrent=function(e){var t;if("string"==typeof e)this._currentCfi=e;else{if("number"!=typeof e)return;this._current=e}0!==this._locations.length&&("string"==typeof e?(t=this.locationFromCfi(e),this._current=t):t=e,this.trigger("changed",{percentage:this.percentageFromLocation(t)}))},Object.defineProperty(EPUBJS.Locations.prototype,"currentLocation",{get:function(){return this._current},set:function(e){this.setCurrent(e)}}),RSVP.EventTarget.mixin(EPUBJS.Locations.prototype),EPUBJS.Pagination=function(e){this.pages=[],this.locations=[],this.epubcfi=new EPUBJS.EpubCFI,e&&e.length&&this.process(e)},EPUBJS.Pagination.prototype.process=function(e){e.forEach(function(e){this.pages.push(e.page),this.locations.push(e.cfi)},this),this.pageList=e,this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage},EPUBJS.Pagination.prototype.pageFromCfi=function(e){var t=-1;if(0===this.locations.length)return-1;var r=EPUBJS.core.indexOfSorted(e,this.locations,this.epubcfi.compare);return-1!=r?t=this.pages[r]:void 0!==(t=(r=EPUBJS.core.locationOf(e,this.locations,this.epubcfi.compare))-1>=0?this.pages[r-1]:this.pages[0])||(t=-1),t},EPUBJS.Pagination.prototype.cfiFromPage=function(e){var t=-1;"number"!=typeof e&&(e=parseInt(e));var r=this.pages.indexOf(e);return-1!=r&&(t=this.locations[r]),t},EPUBJS.Pagination.prototype.pageFromPercentage=function(e){return Math.round(this.totalPages*e)},EPUBJS.Pagination.prototype.percentageFromPage=function(e){return Math.round((e-this.firstPage)/this.totalPages*1e3)/1e3},EPUBJS.Pagination.prototype.percentageFromCfi=function(e){var t=this.pageFromCfi(e);return this.percentageFromPage(t)},EPUBJS.Parser=function(e){this.baseUrl=e||""},EPUBJS.Parser.prototype.container=function(e){var t,r;if(e){if(t=e.querySelector("rootfile"))return{packagePath:r=t.getAttribute("full-path"),basePath:EPUBJS.core.uri(r).directory,encoding:e.xmlEncoding};console.error("No RootFile Found")}else console.error("Container File Not Found")},EPUBJS.Parser.prototype.identifier=function(e){var t;if(e){if(t=e.querySelector("metadata"))return this.getElementText(t,"identifier");console.error("No Metadata Found")}else console.error("Package File Not Found")},EPUBJS.Parser.prototype.packageContents=function(e,t){var r,n,i,o,s,a,c,h,u,l,d;if(t&&(this.baseUrl=t),e)if(r=e.querySelector("metadata"))if(n=e.querySelector("manifest")){if(i=e.querySelector("spine"))return o=this.manifest(n),s=this.findNavPath(n),a=this.findTocPath(n,i),c=this.findCoverPath(e),h=Array.prototype.indexOf.call(i.parentNode.childNodes,i),u=this.spine(i,o),l={},u.forEach(function(e){l[e.href]=e.index}),(d=this.metadata(r)).direction=i.getAttribute("page-progression-direction"),{metadata:d,spine:u,manifest:o,navPath:s,tocPath:a,coverPath:c,spineNodeIndex:h,spineIndexByURL:l};console.error("No Spine Found")}else console.error("No Manifest Found");else console.error("No Metadata Found");else console.error("Package File Not Found")},EPUBJS.Parser.prototype.findNavPath=function(e){var t=e.querySelector("item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']");return!!t&&t.getAttribute("href")},EPUBJS.Parser.prototype.findTocPath=function(e,t){var r,n=e.querySelector("item[media-type='application/x-dtbncx+xml']");return n||(r=t.getAttribute("toc"))&&(n=e.querySelector("item[id='"+r+"']")),!!n&&n.getAttribute("href")},EPUBJS.Parser.prototype.metadata=function(e){var t={},r=this;return t.bookTitle=r.getElementText(e,"title"),t.creator=r.getElementText(e,"creator"),t.description=r.getElementText(e,"description"),t.pubdate=r.getElementText(e,"date"),t.publisher=r.getElementText(e,"publisher"),t.identifier=r.getElementText(e,"identifier"),t.language=r.getElementText(e,"language"),t.rights=r.getElementText(e,"rights"),t.modified_date=r.querySelectorText(e,"meta[property='dcterms:modified']"),t.layout=r.querySelectorText(e,"meta[property='rendition:layout']"),t.orientation=r.querySelectorText(e,"meta[property='rendition:orientation']"),t.spread=r.querySelectorText(e,"meta[property='rendition:spread']"),t},EPUBJS.Parser.prototype.findCoverPath=function(e){if("2.0"===e.querySelector("package").getAttribute("version")){var t=e.querySelector('meta[name="cover"]');if(t){var r=t.getAttribute("content"),n=e.querySelector("item[id='"+r+"']");return!!n&&n.getAttribute("href")}return!1}var i=e.querySelector("item[properties='cover-image']");return!!i&&i.getAttribute("href")},EPUBJS.Parser.prototype.getElementText=function(e,t){var r,n=e.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",t);return n&&0!==n.length&&(r=n[0]).childNodes.length?r.childNodes[0].nodeValue:""},EPUBJS.Parser.prototype.querySelectorText=function(e,t){var r=e.querySelector(t);return r&&r.childNodes.length?r.childNodes[0].nodeValue:""},EPUBJS.Parser.prototype.manifest=function(e){var t=this.baseUrl,r={},n=e.querySelectorAll("item");return Array.prototype.slice.call(n).forEach(function(e){var n=e.getAttribute("id"),i=e.getAttribute("href")||"",o=e.getAttribute("media-type")||"",s=e.getAttribute("properties")||"";r[n]={href:i,url:t+i,type:o,properties:s}}),r},EPUBJS.Parser.prototype.spine=function(e,t){var r=e.getElementsByTagName("itemref"),n=Array.prototype.slice.call(r),i=EPUBJS.core.indexOfElementNode(e),o=new EPUBJS.EpubCFI;return n.map(function(e,r){var n=e.getAttribute("idref"),s=o.generateChapterComponent(i,r,n),a=e.getAttribute("properties")||"",c=a.length?a.split(" "):[],h=t[n].properties,u=h.length?h.split(" "):[];return{id:n,linear:e.getAttribute("linear")||"",properties:c,manifestProperties:u,href:t[n].href,url:t[n].url,index:r,cfiBase:s,cfi:"epubcfi("+s+")"}})},EPUBJS.Parser.prototype.querySelectorByType=function(e,t,r){var n=e.querySelector(t+'[*|type="'+r+'"]');if(null!==n&&0!==n.length)return n;n=e.querySelectorAll(t);for(var i=0;i<n.length;i++)if(n[i].getAttributeNS("http://www.idpf.org/2007/ops","type")===r)return n[i]},EPUBJS.Parser.prototype.nav=function(e,t,r){var n=this.querySelectorByType(e,"nav","toc");return this.navItems(n,t,r)},EPUBJS.Parser.prototype.navItems=function(e,t,r){if(!e)return[];var n=e.querySelector("ol");if(!n)return[];var i=[];return Array.prototype.forEach.call(n.childNodes,(function(e){if("li"===e.tagName){var n=e.querySelector("a, span"),o=n.getAttribute("href")||"",s=n.textContent||"",a=o.split("#"),c=t[a[0]],h=r[c],u=h?h.cfi:"",l=this.navItems(e,t,r);i.push({href:o,label:s,spinePos:c,subitems:l,cfi:u})}}).bind(this)),i},EPUBJS.Parser.prototype.toc=function(e,t,r){var n,i,o=e.querySelectorAll("navMap navPoint"),s=o.length,a={},c=[];if(!o||0===s)return c;for(n=0;n<s;++n)a[(i=this.tocItem(o[n],t,r)).id]=i,i.parent?a[i.parent].subitems.push(i):c.push(i);return c},EPUBJS.Parser.prototype.tocItem=function(e,t,r){var n,i=e.getAttribute("id")||!1,o=e.querySelector("content").getAttribute("src"),s=e.querySelector("navLabel"),a=s.textContent?s.textContent:"",c=t[o.split("#")[0]],h=r[c],u=e.parentNode,l=h?h.cfi:"";return u&&"navPoint"===u.nodeName&&(n=u.getAttribute("id")),i||(c?(i=(h=r[c]).id,l=h.cfi):(i="epubjs-autogen-toc-id-"+EPUBJS.core.uuid(),e.setAttribute("id",i))),{id:i,href:o,label:a,spinePos:c,subitems:[],parent:n,cfi:l}},EPUBJS.Parser.prototype.pageList=function(e,t,r){var n,i,o=this.querySelectorByType(e,"nav","page-list"),s=o?o.querySelectorAll("ol li"):[],a=s.length,c=[];if(!s||0===a)return c;for(n=0;n<a;++n)i=this.pageListItem(s[n],t,r),c.push(i);return c},EPUBJS.Parser.prototype.pageListItem=function(e,t,r){e.getAttribute("id");var n,i=e.querySelector("a"),o=i.getAttribute("href")||"",s=parseInt(i.textContent||"");return-1!=o.indexOf("epubcfi")?{cfi:(n=o.split("#")).length>1&&n[1],href:o,packageUrl:n[0],page:s}:{href:o,page:s}},EPUBJS.Render.Iframe=function(){this.iframe=null,this.document=null,this.window=null,this.docEl=null,this.bodyEl=null,this.leftPos=0,this.pageWidth=0,this.id=EPUBJS.core.uuid()},EPUBJS.Render.Iframe.prototype.create=function(){return this.element=document.createElement("div"),this.element.id="epubjs-view:"+this.id,this.isMobile=navigator.userAgent.match(/(iPad|iPhone|iPod|Mobile|Android)/g),this.transform=EPUBJS.core.prefixed("transform"),this.element},EPUBJS.Render.Iframe.prototype.addIframe=function(){return this.iframe=document.createElement("iframe"),this.iframe.id="epubjs-iframe:"+this.id,this.iframe.scrolling=this.scrolling||"no",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.addEventListener("load",this.loaded.bind(this),!1),(this._width||this._height)&&(this.iframe.height=this._height,this.iframe.width=this._width),this.iframe},EPUBJS.Render.Iframe.prototype.load=function(e,t){var r=this,n=new RSVP.defer;return this.window&&this.unload(),this.iframe&&this.element.removeChild(this.iframe),this.iframe=this.addIframe(),this.element.appendChild(this.iframe),this.iframe.onload=function(e){r.document=r.iframe.contentDocument,r.docEl=r.document.documentElement,r.headEl=r.document.head,r.bodyEl=r.document.body||r.document.querySelector("body"),r.window=r.iframe.contentWindow,r.window.addEventListener("resize",r.resized.bind(r),!1),r.leftPos=0,r.setLeft(0),r.bodyEl&&(r.bodyEl.style.margin="0"),n.resolve(r.docEl)},this.iframe.onerror=function(e){n.reject({message:"Error Loading Contents: "+e,stack:(new Error).stack})},this.document=this.iframe.contentDocument,this.document?(this.iframe.contentDocument.open(),this.iframe.contentDocument.write(e),this.iframe.contentDocument.close(),n.promise):(n.reject(new Error("No Document Available")),n.promise)},EPUBJS.Render.Iframe.prototype.loaded=function(e){var t,r=this.iframe.contentWindow.location.href;this.document=this.iframe.contentDocument,this.docEl=this.document.documentElement,this.headEl=this.document.head,this.bodyEl=this.document.body||this.document.querySelector("body"),this.window=this.iframe.contentWindow,this.window.focus(),"about:blank"!=r&&(t=this.iframe.contentDocument.querySelector("base").getAttribute("href"),this.trigger("render:loaded",t))},EPUBJS.Render.Iframe.prototype.resize=function(e,t){this.element&&(this.element.style.height=t,isNaN(e)||e%2==0||(e+=1),this.element.style.width=e,this.iframe&&(this.iframe.height=t,this.iframe.width=e),this._height=t,this._width=e,this.width=this.element.getBoundingClientRect().width||e,this.height=this.element.getBoundingClientRect().height||t)},EPUBJS.Render.Iframe.prototype.resized=function(e){this.width=this.iframe.getBoundingClientRect().width,this.height=this.iframe.getBoundingClientRect().height},EPUBJS.Render.Iframe.prototype.totalWidth=function(){return this.docEl.scrollWidth},EPUBJS.Render.Iframe.prototype.totalHeight=function(){return this.docEl.scrollHeight},EPUBJS.Render.Iframe.prototype.setPageDimensions=function(e,t){this.pageWidth=e,this.pageHeight=t},EPUBJS.Render.Iframe.prototype.setDirection=function(e){this.direction=e,this.docEl&&"rtl"==this.docEl.dir&&(this.docEl.dir="rtl","pre-paginated"!==this.layout&&(this.docEl.style.position="static",this.docEl.style.right="auto"))},EPUBJS.Render.Iframe.prototype.setLeft=function(e){this.isMobile?this.docEl.style[this.transform]="translate("+-e+"px, 0)":this.document.defaultView.scrollTo(e,0)},EPUBJS.Render.Iframe.prototype.setLayout=function(e){this.layout=e},EPUBJS.Render.Iframe.prototype.setStyle=function(e,t,r){r&&(e=EPUBJS.core.prefixed(e)),this.bodyEl&&(this.bodyEl.style[e]=t)},EPUBJS.Render.Iframe.prototype.removeStyle=function(e){this.bodyEl&&(this.bodyEl.style[e]="")},EPUBJS.Render.Iframe.prototype.setClasses=function(e){this.bodyEl&&(this.bodyEl.className=e.join(" "))},EPUBJS.Render.Iframe.prototype.addHeadTag=function(e,t,r){var n=r||this.document,i=n.createElement(e),o=n.head;for(var s in t)i.setAttribute(s,t[s]);o&&o.insertBefore(i,o.firstChild)},EPUBJS.Render.Iframe.prototype.page=function(e){this.leftPos=this.pageWidth*(e-1),"rtl"===this.direction&&(this.leftPos=-1*this.leftPos),this.setLeft(this.leftPos)},EPUBJS.Render.Iframe.prototype.getPageNumberByElement=function(e){var t;if(e)return t=this.leftPos+e.getBoundingClientRect().left,Math.floor(t/this.pageWidth)+1},EPUBJS.Render.Iframe.prototype.getPageNumberByRect=function(e){return Math.floor((this.leftPos+e.left)/this.pageWidth)+1},EPUBJS.Render.Iframe.prototype.getBaseElement=function(){return this.bodyEl},EPUBJS.Render.Iframe.prototype.getDocumentElement=function(){return this.docEl},EPUBJS.Render.Iframe.prototype.isElementVisible=function(e){var t,r;return!!(e&&"function"==typeof e.getBoundingClientRect&&(r=(t=e.getBoundingClientRect()).left,0!==t.width&&0!==t.height&&r>=0&&r<this.pageWidth))},EPUBJS.Render.Iframe.prototype.scroll=function(e){this.scrolling=e?"yes":"no"},EPUBJS.Render.Iframe.prototype.unload=function(){this.window.removeEventListener("resize",this.resized),this.iframe.removeEventListener("load",this.loaded)},RSVP.EventTarget.mixin(EPUBJS.Render.Iframe.prototype),EPUBJS.Renderer=function(e,t){this.listenedEvents=["keydown","keyup","keypressed","mouseup","mousedown","click"],this.upEvent="mouseup",this.downEvent="mousedown","ontouchstart"in document.documentElement&&(this.listenedEvents.push("touchstart","touchend"),this.upEvent="touchend",this.downEvent="touchstart"),e&&"undefined"!=typeof EPUBJS.Render[e]?this.render=new EPUBJS.Render[e]:console.error("Not a Valid Rendering Method"),this.render.on("render:loaded",this.loaded.bind(this)),this.caches={},this.epubcfi=new EPUBJS.EpubCFI,this.spreads=!0,this.isForcedSingle=!1,this.resized=this.onResized.bind(this),this.layoutSettings={},this.hidden=t||!1,EPUBJS.Hooks.mixin(this),this.getHooks("beforeChapterDisplay"),this._q=EPUBJS.core.queue(this),this._moving=!1},EPUBJS.Renderer.prototype.Events=["renderer:keydown","renderer:keyup","renderer:keypressed","renderer:mouseup","renderer:mousedown","renderer:click","renderer:touchstart","renderer:touchend","renderer:selected","renderer:chapterUnload","renderer:chapterUnloaded","renderer:chapterDisplayed","renderer:locationChanged","renderer:visibleLocationChanged","renderer:visibleRangeChanged","renderer:resized","renderer:spreads","renderer:beforeResize"],EPUBJS.Renderer.prototype.initialize=function(e,t,r){this.container=e,this.element=this.render.create(),this.initWidth=t,this.initHeight=r,this.width=t||this.container.clientWidth,this.height=r||this.container.clientHeight,this.container.appendChild(this.element),t&&r?this.render.resize(this.width,this.height):this.render.resize("100%","100%"),document.addEventListener("orientationchange",this.onResized.bind(this))},EPUBJS.Renderer.prototype.displayChapter=function(e,t){if(this._moving){console.warning("Rendering In Progress");var r=new RSVP.defer;return r.reject({message:"Rendering In Progress",stack:(new Error).stack}),r.promise}return this._moving=!0,e.render().then((function(r){return this.currentChapter&&(this.trigger("renderer:chapterUnload"),this.currentChapter.unload(),this.render.window&&this.render.window.removeEventListener("resize",this.resized),this.removeEventListeners(),this.removeSelectionListeners(),this.trigger("renderer:chapterUnloaded"),this.contents=null,this.doc=null,this.pageMap=null),this.currentChapter=e,this.chapterPos=1,this.currentChapterCfiBase=e.cfiBase,this.layoutSettings=this.reconcileLayoutSettings(t,e.properties),this.load(r,e.href)}).bind(this),(function(){this._moving=!1}).bind(this))},EPUBJS.Renderer.prototype.load=function(e,t){var r=new RSVP.defer;return this.layoutMethod=this.determineLayout(this.layoutSettings),this.layout=new EPUBJS.Layout[this.layoutMethod],this.visible(!1),this.render.load(e,t).then((function(e){EPUBJS.Layout.isFixedLayout(e)&&(this.layoutSettings.layout="pre-paginated",this.layoutMethod=this.determineLayout(this.layoutSettings),this.layout=new EPUBJS.Layout[this.layoutMethod]),this.render.setLayout(this.layoutSettings.layout),"rtl"==this.render.direction&&"rtl"!=this.render.docEl.dir&&(this.render.docEl.dir="rtl","pre-paginated"!==this.render.layout&&(this.render.docEl.style.position="absolute",this.render.docEl.style.right="0")),this.afterLoad(e),this.beforeDisplay((function(){this.afterDisplay(),this.visible(!0),r.resolve(this)}).bind(this))}).bind(this)),r.promise},EPUBJS.Renderer.prototype.afterLoad=function(e){this.contents=e,this.doc=this.render.document,this.formated=this.layout.format(e,this.render.width,this.render.height,this.gap),this.render.setPageDimensions(this.formated.pageWidth,this.formated.pageHeight),this.initWidth||this.initHeight||this.render.window.addEventListener("resize",this.resized,!1),this.addEventListeners(),this.addSelectionListeners()},EPUBJS.Renderer.prototype.afterDisplay=function(e){var t=this.layout.calculatePages(),r=this.currentChapter,n=this._q.length();this._moving=!1,this.updatePages(t),this.visibleRangeCfi=this.getVisibleRangeCfi(),this.currentLocationCfi=this.visibleRangeCfi.start,0===n&&(this.trigger("renderer:locationChanged",this.currentLocationCfi),this.trigger("renderer:visibleRangeChanged",this.visibleRangeCfi)),r.cfi=this.currentLocationCfi,this.trigger("renderer:chapterDisplayed",r)},EPUBJS.Renderer.prototype.loaded=function(e){this.trigger("render:loaded",e)},EPUBJS.Renderer.prototype.reconcileLayoutSettings=function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return t.forEach(function(e){var t,n,i=e.replace("rendition:",""),o=i.indexOf("-");-1!=o&&(t=i.slice(0,o),n=i.slice(o+1),r[t]=n)}),r},EPUBJS.Renderer.prototype.determineLayout=function(e){var t=this.determineSpreads(this.minSpreadWidth),r=t?"ReflowableSpreads":"Reflowable",n=!1;return"pre-paginated"===e.layout&&(r="Fixed",n=!0,t=!1),"reflowable"===e.layout&&"none"===e.spread&&(r="Reflowable",n=!1,t=!1),"reflowable"===e.layout&&"both"===e.spread&&(r="ReflowableSpreads",n=!1,t=!0),this.spreads=t,this.render.scroll(n),this.trigger("renderer:spreads",t),r},EPUBJS.Renderer.prototype.beforeDisplay=function(e,t){this.triggerHooks("beforeChapterDisplay",e,this)},EPUBJS.Renderer.prototype.updatePages=function(e){this.pageMap=this.mapPage(),this.displayedPages=this.spreads?Math.ceil(this.pageMap.length/2):this.pageMap.length,this.currentChapter.pages=this.pageMap.length,this._q.flush()},EPUBJS.Renderer.prototype.reformat=function(){var e,t;this.contents&&((t=this.determineSpreads(this.minSpreadWidth))!=this.spreads&&(this.spreads=t,this.layoutMethod=this.determineLayout(this.layoutSettings),this.layout=new EPUBJS.Layout[this.layoutMethod]),this.chapterPos=1,this.render.page(this.chapterPos),this.formated=this.layout.format(this.render.docEl,this.render.width,this.render.height,this.gap),this.render.setPageDimensions(this.formated.pageWidth,this.formated.pageHeight),e=this.layout.calculatePages(),this.updatePages(e),this.currentLocationCfi&&this.gotoCfi(this.currentLocationCfi))},EPUBJS.Renderer.prototype.visible=function(e){if("undefined"==typeof e)return this.element.style.visibility;!0!==e||this.hidden?!1===e&&(this.element.style.visibility="hidden"):this.element.style.visibility="visible"},EPUBJS.Renderer.prototype.remove=function(){this.render.window&&(this.render.unload(),this.render.window.removeEventListener("resize",this.resized),this.removeEventListeners(),this.removeSelectionListeners()),this.container.removeChild(this.element)},EPUBJS.Renderer.prototype.applyStyles=function(e){for(var t in e)this.render.setStyle(t,e[t])},EPUBJS.Renderer.prototype.setStyle=function(e,t,r){this.render.setStyle(e,t,r)},EPUBJS.Renderer.prototype.removeStyle=function(e){this.render.removeStyle(e)},EPUBJS.Renderer.prototype.setClasses=function(e){this.render.setClasses(e)},EPUBJS.Renderer.prototype.applyHeadTags=function(e){for(var t in e)this.render.addHeadTag(t,e[t])},EPUBJS.Renderer.prototype.page=function(e){return this.pageMap?e>=1&&e<=this.displayedPages&&(this.chapterPos=e,this.render.page(e),this.visibleRangeCfi=this.getVisibleRangeCfi(),this.currentLocationCfi=this.visibleRangeCfi.start,this.trigger("renderer:locationChanged",this.currentLocationCfi),this.trigger("renderer:visibleRangeChanged",this.visibleRangeCfi),!0):(console.warn("pageMap not set, queuing"),this._q.enqueue("page",arguments),!0)},EPUBJS.Renderer.prototype.nextPage=function(){return this.page(this.chapterPos+1)},EPUBJS.Renderer.prototype.prevPage=function(){return this.page(this.chapterPos-1)},EPUBJS.Renderer.prototype.pageByElement=function(e){var t;e&&(t=this.render.getPageNumberByElement(e),this.page(t))},EPUBJS.Renderer.prototype.lastPage=function(){if(this._moving)return this._q.enqueue("lastPage",arguments);this.page(this.displayedPages)},EPUBJS.Renderer.prototype.firstPage=function(){if(this._moving)return this._q.enqueue("firstPage",arguments);this.page(1)},EPUBJS.Renderer.prototype.section=function(e){var t=this.doc.getElementById(e);t&&this.pageByElement(t)},EPUBJS.Renderer.prototype.firstElementisTextNode=function(e){var t=e.childNodes;return!!(t.length&&t[0]&&3===t[0].nodeType&&t[0].textContent.trim().length)},EPUBJS.Renderer.prototype.isGoodNode=function(e){return-1!==["audio","canvas","embed","iframe","img","math","object","svg","video"].indexOf(e.tagName.toLowerCase())||this.firstElementisTextNode(e)},EPUBJS.Renderer.prototype.walk=function(e,t,r){for(var n,i,o,s=e,a=[s],c=0;!n&&a.length;){if(e=a.shift(),this.containsPoint(e,t,r)&&this.isGoodNode(e)&&(n=e),!n&&e&&e.childElementCount>0){if(!(i=e.children)||!i.length)return n;for(var h=(i.length?i.length:0)-1;h>=0;h--)i[h]!=o&&a.unshift(i[h])}if(!n&&0===a.length&&s&&null!==s.parentNode&&(a.push(s.parentNode),o=s,s=s.parentNode),++c>1e4){console.error("ENDLESS LOOP");break}}return n},EPUBJS.Renderer.prototype.containsPoint=function(e,t,r){var n;return!!(e&&"function"==typeof e.getBoundingClientRect&&0!==(n=e.getBoundingClientRect()).width&&0!==n.height&&n.left>=t&&t<=n.left+n.width)},EPUBJS.Renderer.prototype.textSprint=function(e,t){var r,n,i=function(e){return/^\s*$/.test(e.data)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT};try{for(r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:i},!1);n=r.nextNode();)t(n)}catch(o){for(r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,i,!1);n=r.nextNode();)t(n)}},EPUBJS.Renderer.prototype.sprint=function(e,t){for(var r,n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1);r=n.nextNode();)t(r)},EPUBJS.Renderer.prototype.mapPage=function(){var e,t,r,n,i,o,s,a,c=this,h=[],u=this.render.getBaseElement(),l=1,d=this.layout.colWidth+this.layout.gap,f=this.formated.pageWidth*(this.chapterPos-1),p=d*l-f,g=0,m=function(i){var o;return c.splitTextNodeIntoWordsRanges(i).forEach(function(i){var s=i.getBoundingClientRect();!s||0===s.width&&0===s.height||(s.left+s.width<p?h[l-1]||(i.collapse(!0),r=c.currentChapter.cfiFromRange(i),o=h.push({start:r,end:null})):(!e&&n&&(t=c.splitTextNodeIntoWordsRanges(n),e=t[t.length-1]),e&&h.length&&(e.collapse(!1),r=c.currentChapter.cfiFromRange(e),h[h.length-1]&&(h[h.length-1].end=r)),i.collapse(!0),r=c.currentChapter.cfiFromRange(i),o=h.push({start:r,end:null}),g=p=d*(l+=1)-f),e=i)}),o},y=this.render.getDocumentElement(),v=y.dir;return"rtl"==v&&(y.dir="ltr","pre-paginated"!==this.layoutSettings.layout&&(y.style.position="static")),this.textSprint(u,function(t){var r,i,o;if(t.nodeType==Node.TEXT_NODE){if((i=document.createRange()).selectNodeContents(t),!(r=i.getBoundingClientRect())||0===r.width&&0===r.height)return;r.left>g&&(o=m(t)),r.right>g&&(o=m(t)),n=t,o&&(e=null)}}),"rtl"==v&&(y.dir=v,"pre-paginated"!==this.layoutSettings.layout&&(y.style.left="auto",y.style.right="0")),!e&&n&&(t=c.splitTextNodeIntoWordsRanges(n),e=t[t.length-1]),e&&(e.collapse(!1),r=c.currentChapter.cfiFromRange(e),h[h.length-1].end=r),h.length||((i=this.doc.createRange()).selectNodeContents(u),i.collapse(!0),s=c.currentChapter.cfiFromRange(i),(o=this.doc.createRange()).selectNodeContents(u),o.collapse(!1),a=c.currentChapter.cfiFromRange(o),h.push({start:s,end:a})),e=null,t=void 0,i=null,o=null,u=null,h},EPUBJS.Renderer.prototype.indexOfBreakableChar=function(e,t){t||(t=0);for(var r=t;r<e.length;r++)if(-1!="- \t\r\n\b\f".indexOf(e.charAt(r)))return r;return-1},EPUBJS.Renderer.prototype.splitTextNodeIntoWordsRanges=function(e){var t,r=[],n=e.textContent.trim(),i=this.indexOfBreakableChar(n);if(-1===i)return(t=this.doc.createRange()).selectNodeContents(e),[t];for((t=this.doc.createRange()).setStart(e,0),t.setEnd(e,i),r.push(t),(t=this.doc.createRange()).setStart(e,i+1);-1!=i;)(i=this.indexOfBreakableChar(n,i+1))>0&&(t&&(t.setEnd(e,i),r.push(t)),(t=this.doc.createRange()).setStart(e,i+1));return t&&(t.setEnd(e,n.length),r.push(t)),r},EPUBJS.Renderer.prototype.rangePosition=function(e){var t;return(t=e.getClientRects()).length?t[0]:null},EPUBJS.Renderer.prototype.getPageCfi=function(){return this.pageMap[2*this.chapterPos-1].start},EPUBJS.Renderer.prototype.getRange=function(e,t,r){var n=this.doc.createRange();return document,document,this.visibileEl=this.findElementAfter(e,t),n.setStart(this.visibileEl,1),n},EPUBJS.Renderer.prototype.pagesInCurrentChapter=function(){return this.pageMap?this.pageMap.length:(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.currentRenderedPage=function(){return this.pageMap?this.spreads&&this.pageMap.length>1?2*this.chapterPos-1:this.chapterPos:(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.getRenderedPagesLeft=function(){return this.pageMap?this.pageMap.length-(this.spreads?2*this.chapterPos-1:this.chapterPos):(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.getVisibleRangeCfi=function(){var e,t,r;return this.pageMap?(this.spreads?(r=t=this.pageMap[(e=2*this.chapterPos)-2],this.pageMap.length>1&&this.pageMap.length>e-1&&(r=this.pageMap[e-1])):r=t=this.pageMap[(e=this.chapterPos)-1],t||(console.warn("page range miss:",e,this.pageMap),r=t=this.pageMap[this.pageMap.length-1]),{start:t.start,end:r.end}):(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.gotoCfi=function(e){var t,r,n;if(this._moving)return this._q.enqueue("gotoCfi",arguments);if(EPUBJS.core.isString(e)&&(e=this.epubcfi.parse(e)),"undefined"==typeof document.evaluate)(r=this.epubcfi.addMarker(e,this.doc))&&(t=this.render.getPageNumberByElement(r),this.epubcfi.removeMarker(r,this.doc),this.page(t));else if(n=this.epubcfi.generateRangeFromCfi(e,this.doc)){var i=n.getBoundingClientRect();t=i?this.render.getPageNumberByRect(i):1,this.page(t),this.currentLocationCfi=e.str}else this.page(1)},EPUBJS.Renderer.prototype.findFirstVisible=function(e){var t=e||this.render.getBaseElement();return this.walk(t,0,0)||e},EPUBJS.Renderer.prototype.findElementAfter=function(e,t,r){var n=r||this.render.getBaseElement();return this.walk(n,e,t)||n},EPUBJS.Renderer.prototype.resize=function(e,t,r){this.width=e,this.height=t,!1!==r&&this.render.resize(this.width,this.height),this.contents&&this.reformat(),this.trigger("renderer:resized",{width:this.width,height:this.height})},EPUBJS.Renderer.prototype.onResized=function(e){this.trigger("renderer:beforeResize"),this.resize(this.container.clientWidth,this.container.clientHeight,!1)},EPUBJS.Renderer.prototype.addEventListeners=function(){this.render.document&&this.listenedEvents.forEach(function(e){this.render.document.addEventListener(e,this.triggerEvent.bind(this),!1)},this)},EPUBJS.Renderer.prototype.removeEventListeners=function(){this.render.document&&this.listenedEvents.forEach(function(e){this.render.document.removeEventListener(e,this.triggerEvent,!1)},this)},EPUBJS.Renderer.prototype.triggerEvent=function(e){this.trigger("renderer:"+e.type,e)},EPUBJS.Renderer.prototype.addSelectionListeners=function(){this.render.document.addEventListener("selectionchange",this.onSelectionChange.bind(this),!1)},EPUBJS.Renderer.prototype.removeSelectionListeners=function(){this.render.document&&this.doc.removeEventListener("selectionchange",this.onSelectionChange,!1)},EPUBJS.Renderer.prototype.onSelectionChange=function(e){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout((function(){this.selectedRange=this.render.window.getSelection(),this.trigger("renderer:selected",this.selectedRange)}).bind(this),500)},EPUBJS.Renderer.prototype.setMinSpreadWidth=function(e){this.minSpreadWidth=e,this.spreads=this.determineSpreads(e)},EPUBJS.Renderer.prototype.determineSpreads=function(e){return!(this.isForcedSingle||!e||this.width<e)},EPUBJS.Renderer.prototype.forceSingle=function(e){this.isForcedSingle=!!e},EPUBJS.Renderer.prototype.setGap=function(e){this.gap=e},EPUBJS.Renderer.prototype.setDirection=function(e){this.direction=e,this.render.setDirection(this.direction)},EPUBJS.Renderer.prototype.replace=function(e,t,r,n){var i=this.contents.querySelectorAll(e),o=Array.prototype.slice.call(i),s=o.length;0!==s?o.forEach((function(e){var i=!1;t(e,function(e,t){!1===i&&(s--,n&&n(e,t,s),s<=0&&r&&r(!0),i=!0)})}).bind(this)):r(!1)},RSVP.EventTarget.mixin(EPUBJS.Renderer.prototype),(EPUBJS=EPUBJS||{}).replace={},EPUBJS.replace.hrefs=function(e,t){var r=this;t.replace("a[href]",function(e,n){var i,o,s,a,c=e.getAttribute("href"),h=c.search("://");0!==c.indexOf("mailto:")?(-1!=h?e.setAttribute("target","_blank"):(a=t.render.docEl.querySelector("base").getAttribute("href"),i=(s=EPUBJS.core.uri(a)).directory,0===c.indexOf("#")&&(c=s.filename+c),o=i?EPUBJS.core.resolveUrl("file"===s.protocol?s.base:i,c):c,e.onclick=function(){return r.trigger("book:linkClicked",c),r.goto(o),!1}),n()):n()},e)},EPUBJS.replace.head=function(e,t){t.replaceWithStored("link[href]","href",EPUBJS.replace.links,e)},EPUBJS.replace.resources=function(e,t){t.replaceWithStored("[src]","src",EPUBJS.replace.srcs,e)},EPUBJS.replace.posters=function(e,t){t.replaceWithStored("[poster]","poster",EPUBJS.replace.srcs,e)},EPUBJS.replace.svg=function(e,t){t.replaceWithStored("svg image","xlink:href",function(e,t,r){e.getUrl(t).then(r)},e)},EPUBJS.replace.srcs=function(e,t,r){-1===t.search("://")?e.getUrl(t).then(r):r()},EPUBJS.replace.links=function(e,t,r,n){"stylesheet"===n.getAttribute("rel")?EPUBJS.replace.stylesheets(e,t).then(function(e,t){r(e,t)},function(e){r(null)}):e.getUrl(t).then(r,function(e){r(null)})},EPUBJS.replace.stylesheets=function(e,t){var r=new RSVP.defer;if(e)return e.getText(t).then(function(n){EPUBJS.replace.cssImports(e,t,n).then(function(i){EPUBJS.replace.cssUrls(e,t,n=i+n).then(function(e){var t=window.URL||window.webkitURL||window.mozURL,n=new Blob([e],{type:"text/css"}),i=t.createObjectURL(n);r.resolve(i)},function(e){r.reject(e)})},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},EPUBJS.replace.cssImports=function(e,t,r){var n=new RSVP.defer;if(e){for(var i,o=/@import\s+(?:url\()?\'?\"?((?!data:)[^\'|^\"^\)]*)\'?\"?\)?/gi,s=[],a="";i=o.exec(r);)s.push(i[1]);return 0===s.length&&n.resolve(a),s.forEach(function(r){var i=EPUBJS.core.resolveUrl(t,r);i=EPUBJS.core.uri(i).path,e.getText(i).then(function(e){a+=e,s.indexOf(r)===s.length-1&&n.resolve(a)},function(e){n.reject(e)})}),n.promise}},EPUBJS.replace.cssUrls=function(e,t,r){var n=new RSVP.defer,i=r.match(/url\(\'?\"?((?!data:)[^\'|^\"^\)]*)\'?\"?\)/g);if(e){if(!i)return n.resolve(r),n.promise;var o=i.map(function(i){var o=EPUBJS.core.resolveUrl(t,i.replace(/url\(|[|\)|\'|\"]|\?.*$/g,""));return e.getUrl(o).then(function(e){r=r.replace(i,'url("'+e+'")')},function(e){n.reject(e)})});return RSVP.all(o).then(function(){n.resolve(r)}),n.promise}},EPUBJS.Storage=function(e){this.checkRequirements(),this.urlCache={},this.withCredentials=e,this.URL=window.URL||window.webkitURL||window.mozURL,this.offline=!1},EPUBJS.Storage.prototype.checkRequirements=function(e){"undefined"==typeof localforage&&console.error("localForage library not loaded")},EPUBJS.Storage.prototype.put=function(e,t){var r=new RSVP.defer,n=e.length,i=0,o=(function(t){var r,s,a=t||new RSVP.defer;return i>=n?a.resolve():(r=e[i].url,s=window.encodeURIComponent(r),EPUBJS.core.request(r,"binary").then(function(e){return localforage.setItem(s,e)}).then(function(e){i++,setTimeout(function(){o(a)},1)})),a.promise}).bind(this);return Array.isArray(e)||(e=[e]),o().then((function(){r.resolve()}).bind(this)),r.promise},EPUBJS.Storage.prototype.token=function(e,t){var r=window.encodeURIComponent(e);return localforage.setItem(r,t).then(function(e){return null!==e})},EPUBJS.Storage.prototype.isStored=function(e){var t=window.encodeURIComponent(e);return localforage.getItem(t).then(function(e){return null!==e})},EPUBJS.Storage.prototype.getText=function(e){var t=window.encodeURIComponent(e);return EPUBJS.core.request(e,"arraybuffer",this.withCredentials).then((function(e){return this.offline&&(this.offline=!1,this.trigger("offline",!1)),localforage.setItem(t,e),e}).bind(this)).then(function(t){var r=new RSVP.defer,n=EPUBJS.core.getMimeType(e),i=new Blob([t],{type:n}),o=new FileReader;return o.addEventListener("loadend",function(){r.resolve(o.result)}),o.readAsText(i,n),r.promise}).catch((function(){var r=new RSVP.defer,n=localforage.getItem(t);return this.offline||(this.offline=!0,this.trigger("offline",!0)),n?(n.then(function(t){var n=EPUBJS.core.getMimeType(e),i=new Blob([t],{type:n}),o=new FileReader;o.addEventListener("loadend",function(){r.resolve(o.result)}),o.readAsText(i,n)}),r.promise):(r.reject({message:"File not found in the storage: "+e,stack:(new Error).stack}),r.promise)}).bind(this))},EPUBJS.Storage.prototype.getUrl=function(e){var t=window.encodeURIComponent(e);return EPUBJS.core.request(e,"arraybuffer",this.withCredentials).then((function(r){return this.offline&&(this.offline=!1,this.trigger("offline",!1)),localforage.setItem(t,r),e}).bind(this)).catch((function(){var r,n,i=new RSVP.defer,o=window.URL||window.webkitURL||window.mozURL;return this.offline||(this.offline=!0,this.trigger("offline",!0)),t in this.urlCache?(i.resolve(this.urlCache[t]),i.promise):(r=localforage.getItem(t))?(r.then((function(r){var s=new Blob([r],{type:EPUBJS.core.getMimeType(e)});n=o.createObjectURL(s),i.resolve(n),this.urlCache[t]=n}).bind(this)),i.promise):(i.reject({message:"File not found in the storage: "+e,stack:(new Error).stack}),i.promise)}).bind(this))},EPUBJS.Storage.prototype.getXml=function(e){var t=window.encodeURIComponent(e);return EPUBJS.core.request(e,"arraybuffer",this.withCredentials).then((function(e){return this.offline&&(this.offline=!1,this.trigger("offline",!1)),localforage.setItem(t,e),e}).bind(this)).then(function(t){var r=new RSVP.defer,n=EPUBJS.core.getMimeType(e),i=new Blob([t],{type:n}),o=new FileReader;return o.addEventListener("loadend",function(){var e=(new DOMParser).parseFromString(o.result,"text/xml");r.resolve(e)}),o.readAsText(i,n),r.promise}).catch((function(){var r=new RSVP.defer,n=localforage.getItem(t);return this.offline||(this.offline=!0,this.trigger("offline",!0)),n?(n.then(function(t){var n=EPUBJS.core.getMimeType(e),i=new Blob([t],{type:n}),o=new FileReader;o.addEventListener("loadend",function(){var e=(new DOMParser).parseFromString(o.result,"text/xml");r.resolve(e)}),o.readAsText(i,n)}),r.promise):(r.reject({message:"File not found in the storage: "+e,stack:(new Error).stack}),r.promise)}).bind(this))},EPUBJS.Storage.prototype.revokeUrl=function(e){var t=window.URL||window.webkitURL||window.mozURL,r=this.urlCache[e];r&&t.revokeObjectURL(r)},EPUBJS.Storage.prototype.failed=function(e){console.error(e)},RSVP.EventTarget.mixin(EPUBJS.Storage.prototype),EPUBJS.Unarchiver=function(e){this.checkRequirements(),this.urlCache={}},EPUBJS.Unarchiver.prototype.checkRequirements=function(e){"undefined"==typeof JSZip&&console.error("JSZip lib not loaded")},EPUBJS.Unarchiver.prototype.open=function(e,t){if(e instanceof ArrayBuffer){this.zip=new JSZip(e);var r=new RSVP.defer;return r.resolve(),r.promise}return EPUBJS.core.request(e,"binary").then((function(e){this.zip=new JSZip(e)}).bind(this))},EPUBJS.Unarchiver.prototype.getXml=function(e,t){var r=window.decodeURIComponent(e);return this.getText(r,t).then(function(t){var r=new DOMParser,n=EPUBJS.core.getMimeType(e);return 65279===t.charCodeAt(0)&&(t=t.slice(1)),r.parseFromString(t,n)})},EPUBJS.Unarchiver.prototype.getUrl=function(e,t){var r,n,i=new RSVP.defer,o=window.decodeURIComponent(e),s=this.zip.file(o),a=window.URL||window.webkitURL||window.mozURL;return s?e in this.urlCache?(i.resolve(this.urlCache[e]),i.promise):(n=new Blob([s.asUint8Array()],{type:EPUBJS.core.getMimeType(s.name)}),r=a.createObjectURL(n),i.resolve(r),this.urlCache[e]=r,i.promise):(i.reject({message:"File not found in the epub: "+e,stack:(new Error).stack}),i.promise)},EPUBJS.Unarchiver.prototype.getText=function(e,t){var r,n=new RSVP.defer,i=window.decodeURIComponent(e),o=this.zip.file(i);return o?(r=o.asText(),n.resolve(r),n.promise):(n.reject({message:"File not found in the epub: "+e,stack:(new Error).stack}),n.promise)},EPUBJS.Unarchiver.prototype.revokeUrl=function(e){var t=window.URL||window.webkitURL||window.mozURL,r=this.urlCache[e];r&&t.revokeObjectURL(r)},EPUBJS.Unarchiver.prototype.failed=function(e){console.error(e)},EPUBJS.Unarchiver.prototype.afterSaved=function(e){this.callback()},EPUBJS.Unarchiver.prototype.toStorage=function(e){var t=0,r=this,n=e.length;function i(){0==--n&&r.afterSaved()}e.forEach(function(e){setTimeout(function(e){r.saveEntryFileToStorage(e,i)},t,e),t+=20}),console.log("time",t)},function(){"use strict";var e={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},text:{"cache-manifest":["manifest","appcache"],calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcard":"vcf",sgml:["sgml","sgm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},t=function(){var t,r,n,i,o={};for(t in e)if(e.hasOwnProperty(t))for(r in e[t])if(e[t].hasOwnProperty(r))if("string"==typeof(n=e[t][r]))o[n]=t+"/"+r;else for(i=0;i<n.length;i++)o[n[i]]=t+"/"+r;return o}();EPUBJS.core.getMimeType=function(e){return e&&t[e.split(".").pop().toLowerCase()]||"text/plain"}}(),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=e()}(function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=r[s]={exports:{}};t[s][0].call(u.exports,function(e){return i(t[s][1][e]||e)},u,u.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){(function(e){"use strict";function r(){h=!0;for(var e,t,r=u.length;r;){for(t=u,u=[],e=-1;++e<r;)t[e]();r=u.length}h=!1}var n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,s=new i(r),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){r(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(r,0)};else{var c=new e.MessageChannel;c.port1.onmessage=r,n=function(){c.port2.postMessage(0)}}var h,u=[];t.exports=function(e){1!==u.push(e)||h||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";function n(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,e!==n&&c(this,e)}function o(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function s(e,t,r){u(function(){var n;try{n=t(r)}catch(t){return l.reject(e,t)}n===e?l.reject(e,new TypeError("Cannot resolve promise with itself")):l.resolve(e,n)})}function a(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function c(e,t){function r(t){i||(i=!0,l.reject(e,t))}function n(t){i||(i=!0,l.resolve(e,t))}var i=!1,o=h(function(){t(n,r)});"error"===o.status&&r(o.value)}function h(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}var u=e(1),l={},d=["REJECTED"],f=["FULFILLED"],p=["PENDING"];t.exports=r=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===f||"function"!=typeof t&&this.state===d)return this;var r=new this.constructor(n);return this.state!==p?s(r,this.state===f?e:t,this.outcome):this.queue.push(new o(r,e,t)),r},o.prototype.callFulfilled=function(e){l.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){s(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){l.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){s(this.promise,this.onRejected,e)},l.resolve=function(e,t){var r=h(a,t);if("error"===r.status)return l.reject(e,r.value);var n=r.value;if(n)c(e,n);else{e.state=f,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},l.reject=function(e,t){e.state=d,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},r.resolve=function(e){return e instanceof this?e:l.resolve(new this(n),e)},r.reject=function(e){var t=new this(n);return l.reject(t,e)},r.all=function(e){function t(e,t){r.resolve(e).then(function(e){s[t]=e,++a!==i||o||(o=!0,l.resolve(h,s))},function(e){o||(o=!0,l.reject(h,e))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,o=!1;if(!i)return this.resolve([]);for(var s=new Array(i),a=0,c=-1,h=new this(n);++c<i;)t(e[c],c);return h},r.race=function(e){function t(e){r.resolve(e).then(function(e){o||(o=!0,l.resolve(a,e))},function(e){o||(o=!0,l.reject(a,e))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,o=!1;if(!i)return this.resolve([]);for(var s=-1,a=new this(n);++s<i;)t(e[s]);return a}},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){"use strict";function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}function i(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function o(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function s(e,t){return new b(function(r,n){if(e.db){if(!t)return r(e.db);(function(e){var t=v[e.name],r={};r.promise=new b(function(e){r.resolve=e}),t.deferredOperations.push(r),t.dbReady=t.dbReady?t.dbReady.then(function(){return r.promise}):r.promise})(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var o=m.open.apply(m,i);t&&(o.onupgradeneeded=function(t){var r=o.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(E)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),n(o.error)},o.onsuccess=function(){r(o.result),function(e){var t=v[e.name].deferredOperations.pop();t&&t.resolve()}(e)}})}function a(e){return n([function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}(atob(e.data))],{type:e.type})}function c(e){return e&&e.__local_forage_encoded_blob}function h(e){var t=this,r=t._initReady().then(function(){var e=v[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return o(r,e,e),r}function u(e){var t,r,n,i,o,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var h=new ArrayBuffer(s),u=new Uint8Array(h);for(t=0;t<a;t+=4)r=w.indexOf(e[t]),n=w.indexOf(e[t+1]),i=w.indexOf(e[t+2]),o=w.indexOf(e[t+3]),u[c++]=r<<2|n>>4,u[c++]=(15&n)<<4|i>>2,u[c++]=(3&i)<<6|63&o;return h}function l(e){var t,r=new Uint8Array(e),n="";for(t=0;t<r.length;t+=3)n+=w[r[t]>>2],n+=w[(3&r[t])<<4|r[t+1]>>4],n+=w[(15&r[t+1])<<2|r[t+2]>>6],n+=w[63&r[t+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function d(e,t){e[t]=function(){var r=arguments;return e.ready().then(function(){return e[t].apply(e,r)})}}function f(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(arguments[0][r]=F(t[r])?t[r].slice():t[r])}return arguments[0]}function p(e){for(var t in L)if(L.hasOwnProperty(t)&&L[t]===e)return!0;return!1}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){}}();"undefined"==typeof Promise&&e(3);var y,v,b=Promise,E="local-forage-detect-blob-support",_=Object.prototype.toString,S={_driver:"asyncStorage",_initStorage:function(e){function t(){return b.resolve()}var r=this,n={db:null};if(e)for(var i in e)n[i]=e[i];v||(v={});var o=v[n.name];o||(v[n.name]=o={forages:[],db:null,dbReady:null,deferredOperations:[]}),o.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=h);for(var a=[],c=0;c<o.forages.length;c++){var u=o.forages[c];u!==r&&a.push(u._initReady().catch(t))}var l=o.forages.slice(0);return b.all(a).then(function(){return n.db=o.db,s(n,!1)}).then(function(e){return n.db=e,function(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version>e.db.version;if(e.version<e.db.version&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),n||r){if(r){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}(n,r._defaultConfig.version)?s(n,!0):e}).then(function(e){n.db=o.db=e,r._dbInfo=n;for(var t=0;t<l.length;t++){var i=l[t];i!==r&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}})},iterate:function(e,t){var r=this,n=new b(function(t,n){r.ready().then(function(){var i=r._dbInfo,o=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName).openCursor(),s=1;o.onsuccess=function(){var r=o.result;if(r){var n=r.value;c(n)&&(n=a(n));var i=e(n,r.key,s++);void 0!==i?t(i):r.continue()}else t()},o.onerror=function(){n(o.error)}}).catch(n)});return i(n,t),n},getItem:function(e,t){var r=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var n=new b(function(t,n){r.ready().then(function(){var i=r._dbInfo,o=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),c(e)&&(e=a(e)),t(e)},o.onerror=function(){n(o.error)}}).catch(n)});return i(n,t),n},setItem:function(e,t,r){var o=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var s=new b(function(r,i){var s;o.ready().then(function(){return s=o._dbInfo,"[object Blob]"===_.call(t)?(e=s.db,"boolean"==typeof y?b.resolve(y):function(e){return new b(function(t){var r=e.transaction(E,"readwrite"),i=n([""]);r.objectStore(E).put(i,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return y=e})).then(function(e){return e?t:function(e){return new b(function(t,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)})}(t)}):t;var e}).then(function(t){var n=s.db.transaction(s.storeName,"readwrite"),o=n.objectStore(s.storeName).put(t,e);null===t&&(t=void 0),n.oncomplete=function(){void 0===t&&(t=null),r(t)},n.onabort=n.onerror=function(){i(o.error?o.error:o.transaction.error)}}).catch(i)});return i(s,r),s},removeItem:function(e,t){var r=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var n=new b(function(t,n){r.ready().then(function(){var i=r._dbInfo,o=i.db.transaction(i.storeName,"readwrite"),s=o.objectStore(i.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){n(s.error)},o.onabort=function(){n(s.error?s.error:s.transaction.error)}}).catch(n)});return i(n,t),n},clear:function(e){var t=this,r=new b(function(e,r){t.ready().then(function(){var n=t._dbInfo,i=n.db.transaction(n.storeName,"readwrite"),o=i.objectStore(n.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){r(o.error?o.error:o.transaction.error)}}).catch(r)});return i(r,e),r},length:function(e){var t=this,r=new b(function(e,r){t.ready().then(function(){var n=t._dbInfo,i=n.db.transaction(n.storeName,"readonly").objectStore(n.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){r(i.error)}}).catch(r)});return i(r,e),r},key:function(e,t){var r=this,n=new b(function(t,n){return e<0?void t(null):void r.ready().then(function(){var i=r._dbInfo,o=!1,s=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName).openCursor();s.onsuccess=function(){var r=s.result;return r?void(0===e?t(r.key):o?t(r.key):(o=!0,r.advance(e))):void t(null)},s.onerror=function(){n(s.error)}}).catch(n)});return i(n,t),n},keys:function(e){var t=this,r=new b(function(e,r){t.ready().then(function(){var n=t._dbInfo,i=n.db.transaction(n.storeName,"readonly").objectStore(n.storeName).openCursor(),o=[];i.onsuccess=function(){var t=i.result;return t?(o.push(t.key),void t.continue()):void e(o)},i.onerror=function(){r(i.error)}}).catch(r)});return i(r,e),r}},w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",P=/^~~local_forage_type~([^~]+)~/,B="__lfsc__:",x=B.length,U="arbf",k="blob",C=x+U.length,R=Object.prototype.toString,J={serialize:function(e,t){var r="";if(e&&(r=R.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===R.call(e.buffer))){var n,i=B;e instanceof ArrayBuffer?(n=e,i+=U):(n=e.buffer,"[object Int8Array]"===r?i+="si08":"[object Uint8Array]"===r?i+="ui08":"[object Uint8ClampedArray]"===r?i+="uic8":"[object Int16Array]"===r?i+="si16":"[object Uint16Array]"===r?i+="ur16":"[object Int32Array]"===r?i+="si32":"[object Uint32Array]"===r?i+="ui32":"[object Float32Array]"===r?i+="fl32":"[object Float64Array]"===r?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+l(n))}else if("[object Blob]"===r){var o=new FileReader;o.onload=function(){var r="~~local_forage_type~"+e.type+"~"+l(this.result);t(B+k+r)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}},deserialize:function(e){if(e.substring(0,x)!==B)return JSON.parse(e);var t,r=e.substring(C),i=e.substring(x,C);if(i===k&&P.test(r)){var o=r.match(P);t=o[1],r=r.substring(o[0].length)}var s=u(r);switch(i){case U:return s;case k:return n([s],{type:t});case"si08":return new Int8Array(s);case"ui08":return new Uint8Array(s);case"uic8":return new Uint8ClampedArray(s);case"si16":return new Int16Array(s);case"ur16":return new Uint16Array(s);case"si32":return new Int32Array(s);case"ui32":return new Uint32Array(s);case"fl32":return new Float32Array(s);case"fl64":return new Float64Array(s);default:throw new Error("Unkown type: "+i)}},stringToBuffer:u,bufferToString:l},I={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new b(function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction(function(i){i.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){t._dbInfo=r,e()},function(e,t){n(t)})})});return r.serializer=J,i},iterate:function(e,t){var r=this,n=new b(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT * FROM "+i.storeName,[],function(r,n){for(var o=n.rows,s=o.length,a=0;a<s;a++){var c=o.item(a),h=c.value;if(h&&(h=i.serializer.deserialize(h)),void 0!==(h=e(h,c.key,a+1)))return void t(h)}t()},function(e,t){n(t)})})}).catch(n)});return i(n,t),n},getItem:function(e,t){var r=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var n=new b(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)},function(e,t){n(t)})})}).catch(n)});return i(n,t),n},setItem:function(e,t,r){return(function e(t,r,n,o){var s=this;"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t));var a=new b(function(i,a){s.ready().then(function(){void 0===r&&(r=null);var c=r,h=s._dbInfo;h.serializer.serialize(r,function(r,u){u?a(u):h.db.transaction(function(e){e.executeSql("INSERT OR REPLACE INTO "+h.storeName+" (key, value) VALUES (?, ?)",[t,r],function(){i(c)},function(e,t){a(t)})},function(r){if(r.code===r.QUOTA_ERR){if(o>0)return void i(e.apply(s,[t,c,n,o-1]));a(r)}})})}).catch(a)});return i(a,n),a}).apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var n=new b(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){n(t)})})}).catch(n)});return i(n,t),n},clear:function(e){var t=this,r=new b(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){t.executeSql("DELETE FROM "+n.storeName,[],function(){e()},function(e,t){r(t)})})}).catch(r)});return i(r,e),r},length:function(e){var t=this,r=new b(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,r){var n=r.rows.item(0).c;e(n)},function(e,t){r(t)})})}).catch(r)});return i(r,e),r},key:function(e,t){var r=this,n=new b(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,r){var n=r.rows.length?r.rows.item(0).key:null;t(n)},function(e,t){n(t)})})}).catch(n)});return i(n,t),n},keys:function(e){var t=this,r=new b(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){t.executeSql("SELECT key FROM "+n.storeName,[],function(t,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);e(n)},function(e,t){r(t)})})}).catch(r)});return i(r,e),r}},A={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=t.name+"/",t.storeName!==this._defaultConfig.storeName&&(t.keyPrefix+=t.storeName+"/"),this._dbInfo=t,t.serializer=J,b.resolve()},iterate:function(e,t){var r=this,n=r.ready().then(function(){for(var t=r._dbInfo,n=t.keyPrefix,i=n.length,o=localStorage.length,s=1,a=0;a<o;a++){var c=localStorage.key(a);if(0===c.indexOf(n)){var h=localStorage.getItem(c);if(h&&(h=t.serializer.deserialize(h)),void 0!==(h=e(h,c.substring(i),s++)))return h}}});return i(n,t),n},getItem:function(e,t){var r=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var n=r.ready().then(function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n});return i(n,t),n},setItem:function(e,t,r){var n=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var o=n.ready().then(function(){void 0===t&&(t=null);var r=t;return new b(function(i,o){var s=n._dbInfo;s.serializer.serialize(t,function(t,n){if(n)o(n);else try{localStorage.setItem(s.keyPrefix+e,t),i(r)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}})})});return i(o,r),o},removeItem:function(e,t){var r=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var n=r.ready().then(function(){localStorage.removeItem(r._dbInfo.keyPrefix+e)});return i(n,t),n},clear:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}});return i(r,e),r},length:function(e){var t=this.keys().then(function(e){return e.length});return i(t,e),t},key:function(e,t){var r=this,n=r.ready().then(function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t});return i(n,t),n},keys:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo,r=localStorage.length,n=[],i=0;i<r;i++)0===localStorage.key(i).indexOf(e.keyPrefix)&&n.push(localStorage.key(i).substring(e.keyPrefix.length));return n});return i(r,e),r}},T={},L={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},O=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],N={description:"",driver:[L.INDEXEDDB,L.WEBSQL,L.LOCALSTORAGE].slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},z={};z[L.INDEXEDDB]=function(){try{if(!m)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),z[L.WEBSQL]="function"==typeof openDatabase,z[L.LOCALSTORAGE]=function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&localStorage.setItem}catch(e){return!1}}();var F=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},D=new(function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.INDEXEDDB=L.INDEXEDDB,this.LOCALSTORAGE=L.LOCALSTORAGE,this.WEBSQL=L.WEBSQL,this._defaultConfig=f({},N),this._config=f({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===("undefined"==typeof e?"undefined":g(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var n=new b(function(t,r){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),o=new Error("Custom driver name already in use: "+e._driver);if(!e._driver)return void r(i);if(p(e._driver))return void r(o);for(var s=O.concat("_initStorage"),a=0;a<s.length;a++){var c=s[a];if(!c||!e[c]||"function"!=typeof e[c])return void r(i)}var h=b.resolve(!0);"_support"in e&&(h=e._support&&"function"==typeof e._support?e._support():b.resolve(!!e._support)),h.then(function(r){z[n]=r,T[n]=e,t()},r)}catch(e){r(e)}});return o(n,t,r),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var n=this,i=b.resolve().then(function(){if(!p(e)){if(T[e])return T[e];throw new Error("Driver not found.")}switch(e){case n.INDEXEDDB:return S;case n.LOCALSTORAGE:return A;case n.WEBSQL:return I}});return o(i,t,r),i},e.prototype.getSerializer=function(e){var t=b.resolve(J);return o(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return o(r,e,e),r},e.prototype.setDriver=function(e,t,r){function n(){s._config.driver=s.driver()}function i(e){return s._extend(e),n(),s._ready=s._initStorage(s._config),s._ready}var s=this;F(e)||(e=[e]);var a=this._getSupportedDrivers(e),c=null!==this._driverSet?this._driverSet.catch(function(){return b.resolve()}):b.resolve();return this._driverSet=c.then(function(){var e=a[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then(function(e){s._driver=e._driver,n(),s._wrapLibraryMethodsWithReady(),s._initDriver=function(e){return function(){var t=0;return function r(){for(;t<e.length;){var o=e[t];return t++,s._dbInfo=null,s._ready=null,s.getDriver(o).then(i).catch(r)}n();var a=new Error("No available storage method found.");return s._driverSet=b.reject(a),s._driverSet}()}}(a)})}).catch(function(){n();var e=new Error("No available storage method found.");return s._driverSet=b.reject(e),s._driverSet}),o(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!z[e]},e.prototype._extend=function(e){f(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0;e<O.length;e++)d(this,O[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=D},{3:3}]},{},[4])(4)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JSZip=e()}}(function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var h=r[s]={exports:{}};t[s][0].call(h.exports,function(e){return i(t[s][1][e]||e)},h,h.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,o,s,a,c,h="",u=0;u<e.length;)o=(t=e.charCodeAt(u++))>>2,s=(3&t)<<4|(r=e.charCodeAt(u++))>>4,a=(15&r)<<2|(i=e.charCodeAt(u++))>>6,c=63&i,isNaN(r)?a=c=64:isNaN(i)&&(c=64),h=h+n.charAt(o)+n.charAt(s)+n.charAt(a)+n.charAt(c);return h},r.decode=function(e){var t,r,i,o,s,a,c="",h=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<e.length;)i=n.indexOf(e.charAt(h++)),t=(15&(o=n.indexOf(e.charAt(h++))))<<4|(s=n.indexOf(e.charAt(h++)))>>2,r=(3&s)<<6|(a=n.indexOf(e.charAt(h++))),c+=String.fromCharCode(i<<2|o>>4),64!=s&&(c+=String.fromCharCode(t)),64!=a&&(c+=String.fromCharCode(r));return c}},{}],2:[function(e,t){"use strict";function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=r},{}],3:[function(e,t,r){"use strict";r.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},r.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t){"use strict";var r=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if("undefined"==typeof e||!e.length)return 0;var i="string"!==r.getTypeOf(e);"undefined"==typeof t&&(t=0);var o=0;t^=-1;for(var s=0,a=e.length;a>s;s++)o=i?e[s]:e.charCodeAt(s),t=t>>>8^n[255&(t^o)];return-1^t}},{"./utils":21}],5:[function(e,t){"use strict";function r(){this.data=null,this.length=0,this.index=0}var n=e("./utils");r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=r},{"./utils":21}],6:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!1,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],7:[function(e,t,r){"use strict";var n=e("./utils");r.string2binary=function(e){return n.string2binary(e)},r.string2Uint8Array=function(e){return n.transformTo("uint8array",e)},r.uint8Array2String=function(e){return n.transformTo("string",e)},r.string2Blob=function(e){var t=n.transformTo("arraybuffer",e);return n.arrayBuffer2Blob(t)},r.arrayBuffer2Blob=function(e){return n.arrayBuffer2Blob(e)},r.transformTo=function(e,t){return n.transformTo(e,t)},r.getTypeOf=function(e){return n.getTypeOf(e)},r.checkSupport=function(e){return n.checkSupport(e)},r.MAX_VALUE_16BITS=n.MAX_VALUE_16BITS,r.MAX_VALUE_32BITS=n.MAX_VALUE_32BITS,r.pretty=function(e){return n.pretty(e)},r.findCompression=function(e){return n.findCompression(e)},r.isRegExp=function(e){return n.isRegExp(e)}},{"./utils":21}],8:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako");r.uncompressInputType=n?"uint8array":"array",r.compressInputType=n?"uint8array":"array",r.magic="\b\0",r.compress=function(e,t){return i.deflateRaw(e,{level:t.level||-1})},r.uncompress=function(e){return i.inflateRaw(e)}},{pako:24}],9:[function(e,t){"use strict";function r(e,t){return this instanceof r?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new r(e,t)}var n=e("./base64");(r.prototype=e("./object")).load=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.utils=e("./deprecatedPublicUtils"),r.base64={encode:function(e){return n.encode(e)},decode:function(e){return n.decode(e)}},r.compressions=e("./compressions"),t.exports=r},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t){"use strict";var r=e("./base64"),n=e("./zipEntries");t.exports=function(e,t){var i,o,s,a;for((t=t||{}).base64&&(e=r.decode(e)),i=(o=new n(e,t)).files,s=0;s<i.length;s++)this.file((a=i[s]).fileName,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileComment.length?a.fileComment:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:t.createFolders});return o.zipComment.length&&(this.comment=o.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,t){(function(e){"use strict";t.exports=function(t,r){return new e(t,r)},t.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(e,t){"use strict";function r(e){this.data=e,this.length=this.data.length,this.index=0}var n=e("./uint8ArrayReader");(r.prototype=new n).readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./uint8ArrayReader":18}],13:[function(e,t){"use strict";var r=e("./support"),n=e("./utils"),i=e("./crc32"),o=e("./signature"),s=e("./defaults"),a=e("./base64"),c=e("./compressions"),h=e("./compressedObject"),u=e("./nodeBuffer"),l=e("./utf8"),d=e("./stringWriter"),f=e("./uint8ArrayWriter"),p=function(e){if(e._data instanceof h&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===n.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},g=function(e){var t=p(e);return"string"===n.getTypeOf(t)?!e.options.binary&&r.nodebuffer?u(t,"utf-8"):e.asBinary():t},m=function(e){var t=p(this);return null===t||"undefined"==typeof t?"":(this.options.base64&&(t=a.decode(t)),t=e&&this.options.binary?U.utf8decode(t):n.transformTo("string",t),e||this.options.binary||(t=n.transformTo("string",U.utf8encode(t))),t)},y=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this.options=r,this._initialMetadata={dir:r.dir,date:r.date}};y.prototype={asText:function(){return m.call(this,!0)},asBinary:function(){return m.call(this,!1)},asNodeBuffer:function(){var e=g(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=g(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var v=function(e,t){var r,n="";for(r=0;t>r;r++)n+=String.fromCharCode(255&e),e>>>=8;return n},b=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&"undefined"==typeof r[t]&&(r[t]=arguments[e][t]);return r},E=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=b(e,s)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},_=function(e,t,r){var i,o=n.getTypeOf(t);if("string"==typeof(r=E(r)).unixPermissions&&(r.unixPermissions=parseInt(r.unixPermissions,8)),r.unixPermissions&&16384&r.unixPermissions&&(r.dir=!0),r.dosPermissions&&16&r.dosPermissions&&(r.dir=!0),r.dir&&(e=w(e)),r.createFolders&&(i=S(e))&&P.call(this,i,!0),r.dir||null===t||"undefined"==typeof t)r.base64=!1,r.binary=!1,t=null,o=null;else if("string"===o)r.binary&&!r.base64&&!0!==r.optimizedBinaryString&&(t=n.string2binary(t));else{if(r.base64=!1,r.binary=!0,!(o||t instanceof h))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===o&&(t=n.transformTo("uint8array",t))}var s=new y(e,t,r);return this.files[e]=s,s},S=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},w=function(e){return"/"!=e.slice(-1)&&(e+="/"),e},P=function(e,t){return t="undefined"!=typeof t&&t,e=w(e),this.files[e]||_.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},B=function(e,t,r){var o,s=new h;return e._data instanceof h?(s.uncompressedSize=e._data.uncompressedSize,s.crc32=e._data.crc32,0===s.uncompressedSize||e.dir?(t=c.STORE,s.compressedContent="",s.crc32=0):e._data.compressionMethod===t.magic?s.compressedContent=e._data.getCompressedContent():(o=e._data.getContent(),s.compressedContent=t.compress(n.transformTo(t.compressInputType,o),r))):((!(o=g(e))||0===o.length||e.dir)&&(t=c.STORE,o=""),s.uncompressedSize=o.length,s.crc32=i(o),s.compressedContent=t.compress(n.transformTo(t.compressInputType,o),r)),s.compressedSize=s.compressedContent.length,s.compressionMethod=t.magic,s},x=function(e,t,r,s,a){var c,h,u,d,f=n.transformTo("string",l.utf8encode(t.name)),p=t.comment||"",g=n.transformTo("string",l.utf8encode(p)),m=f.length!==t.name.length,y=g.length!==p.length,b=t.options,E="",_="",S="";u=t._initialMetadata.dir!==t.dir?t.dir:b.dir,d=t._initialMetadata.date!==t.date?t.date:b.date;var w=0,P=0;u&&(w|=16),"UNIX"===a?(P=798,w|=function(e,t){var r=e;return e||(r=u?16893:33204),(65535&r)<<16}(t.unixPermissions)):(P=20,w|=63&(t.dosPermissions||0)),c=d.getHours(),c<<=6,c|=d.getMinutes(),c<<=5,c|=d.getSeconds()/2,h=d.getFullYear()-1980,h<<=4,h|=d.getMonth()+1,h<<=5,h|=d.getDate(),m&&(_=v(1,1)+v(i(f),4)+f,E+="up"+v(_.length,2)+_),y&&(S=v(1,1)+v(this.crc32(g),4)+g,E+="uc"+v(S.length,2)+S);var B="";return B+="\n\0",B+=m||y?"\0\b":"\0\0",B+=r.compressionMethod,B+=v(c,2),B+=v(h,2),B+=v(r.crc32,4),B+=v(r.compressedSize,4),B+=v(r.uncompressedSize,4),B+=v(f.length,2),B+=v(E.length,2),{fileRecord:o.LOCAL_FILE_HEADER+B+f+E,dirRecord:o.CENTRAL_FILE_HEADER+v(P,2)+B+v(g.length,2)+"\0\0\0\0"+v(w,4)+v(s,4)+f+E+g,compressedObject:r}},U={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,r,n,i,o=[];for(t in this.files)this.files.hasOwnProperty(t)&&(i=new y((n=this.files[t]).name,n._data,b(n.options)),r=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(r,i)&&o.push(i));return o},file:function(e,t,r){if(1===arguments.length){if(n.isRegExp(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}return this.filter(function(t,r){return!r.dir&&t===e})[0]||null}return _.call(this,e=this.root+e,t,r),this},folder:function(e){if(!e)return this;if(n.isRegExp(e))return this.filter(function(t,r){return r.dir&&e.test(t)});var t=P.call(this,this.root+e),r=this.clone();return r.root=t.name,r},remove:function(e){var t=this.files[e=this.root+e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter(function(t,r){return r.name.slice(0,e.length)===e}),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(e){e=b(e||{},{base64:!0,compression:"STORE",compressionOptions:null,type:"base64",platform:"DOS",comment:null,mimeType:"application/zip"}),n.checkSupport(e.type),("darwin"===e.platform||"freebsd"===e.platform||"linux"===e.platform||"sunos"===e.platform)&&(e.platform="UNIX"),"win32"===e.platform&&(e.platform="DOS");var t,r,i,s=[],h=0,u=0,l=n.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var p in this.files)if(this.files.hasOwnProperty(p)){var g=this.files[p],m=g.options.compression||e.compression.toUpperCase(),y=c[m];if(!y)throw new Error(m+" is not a valid compression method !");var E=B.call(this,g,y,g.options.compressionOptions||e.compressionOptions||{}),_=x.call(this,p,g,E,h,e.platform);h+=_.fileRecord.length+E.compressedSize,u+=_.dirRecord.length,s.push(_)}i=o.CENTRAL_DIRECTORY_END+"\0\0\0\0"+v(s.length,2)+v(s.length,2)+v(u,4)+v(h,4)+v(l.length,2)+l;var S=e.type.toLowerCase();for(t="uint8array"===S||"arraybuffer"===S||"blob"===S||"nodebuffer"===S?new f(h+u+i.length):new d(h+u+i.length),r=0;r<s.length;r++)t.append(s[r].fileRecord),t.append(s[r].compressedObject.compressedContent);for(r=0;r<s.length;r++)t.append(s[r].dirRecord);t.append(i);var w=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),w);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",w),e.mimeType);case"base64":return e.base64?a.encode(w):w;default:return w}},crc32:function(e,t){return i(e,t)},utf8encode:function(e){return n.transformTo("string",l.utf8encode(e))},utf8decode:function(e){return l.utf8decode(e)}};t.exports=U},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK\x03\x04",r.CENTRAL_FILE_HEADER="PK\x01\x02",r.CENTRAL_DIRECTORY_END="PK\x05\x06",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",r.DATA_DESCRIPTOR="PK\x07\b"},{}],15:[function(e,t){"use strict";function r(e,t){this.data=e,t||(this.data=i.string2binary(this.data)),this.length=this.data.length,this.index=0}var n=e("./dataReader"),i=e("./utils");(r.prototype=new n).byteAt=function(e){return this.data.charCodeAt(e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5,"./utils":21}],16:[function(e,t){"use strict";var r=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=r.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=n},{"./utils":21}],17:[function(e,t,r){(function(e){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer="undefined"!=typeof e,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var t=new ArrayBuffer(0);try{r.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);n.append(t),r.blob=0===n.getBlob("application/zip").size}catch(e){r.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(e,t){"use strict";function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var n=e("./dataReader");(r.prototype=new n).byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===r&&this.data[o+2]===n&&this.data[o+3]===i)return o;return-1},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5}],19:[function(e,t){"use strict";var r=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=r.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=n},{"./utils":21}],20:[function(e,t,r){"use strict";for(var n=e("./utils"),i=e("./support"),o=e("./nodeBuffer"),s=new Array(256),a=0;256>a;a++)s[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;s[254]=s[254]=1;var c=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r?t:0===r?t:r+s[e[r]]>t?r:t},h=function(e){var t,r,i,o,a=e.length,c=new Array(2*a);for(r=0,t=0;a>t;)if(128>(i=e[t++]))c[r++]=i;else if((o=s[i])>4)c[r++]=65533,t+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&a>t;)i=i<<6|63&e[t++],o--;o>1?c[r++]=65533:65536>i?c[r++]=i:(c[r++]=55296|(i-=65536)>>10&1023,c[r++]=56320|1023&i)}return c.length!==r&&(c.subarray?c=c.subarray(0,r):c.length=r),n.applyFromCharCode(c)};r.utf8encode=function(e){return i.nodebuffer?o(e,"utf-8"):function(e){var t,r,n,o,s,a=e.length,c=0;for(o=0;a>o;o++)55296==(64512&(r=e.charCodeAt(o)))&&a>o+1&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),c+=128>r?1:2048>r?2:65536>r?3:4;for(t=i.uint8array?new Uint8Array(c):new Array(c),s=0,o=0;c>s;o++)55296==(64512&(r=e.charCodeAt(o)))&&a>o+1&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),128>r?t[s++]=r:2048>r?(t[s++]=192|r>>>6,t[s++]=128|63&r):65536>r?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|63&r):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|63&r);return t}(e)},r.utf8decode=function(e){if(i.nodebuffer)return n.transformTo("nodebuffer",e).toString("utf-8");for(var t=[],r=0,o=(e=n.transformTo(i.uint8array?"uint8array":"array",e)).length;o>r;){var s=c(e,Math.min(r+65536,o));t.push(h(i.uint8array?e.subarray(r,s):e.slice(r,s))),r=s}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,r){"use strict";function n(e){return e}function i(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}function o(e){var t=65536,n=[],i=e.length,o=r.getTypeOf(e),s=0,a=!0;try{switch(o){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,h(0))}}catch(e){a=!1}if(!a){for(var c="",u=0;u<e.length;u++)c+=String.fromCharCode(e[u]);return c}for(;i>s&&t>1;)try{n.push("array"===o||"nodebuffer"===o?String.fromCharCode.apply(null,e.slice(s,Math.min(s+t,i))):String.fromCharCode.apply(null,e.subarray(s,Math.min(s+t,i)))),s+=t}catch(e){t=Math.floor(t/2)}return n.join("")}function s(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var a=e("./support"),c=e("./compressions"),h=e("./nodeBuffer");r.string2binary=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(255&e.charCodeAt(r));return t},r.arrayBuffer2Blob=function(e,t){r.checkSupport("blob"),t=t||"application/zip";try{return new Blob([e],{type:t})}catch(r){try{var n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return n.append(e),n.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}},r.applyFromCharCode=o;var u={};u.string={string:n,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return u.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,h(e.length))}},u.array={string:o,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return h(e)}},u.arraybuffer={string:function(e){return o(new Uint8Array(e))},array:function(e){return s(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return h(new Uint8Array(e))}},u.uint8array={string:o,array:function(e){return s(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return h(e)}},u.nodebuffer={string:o,array:function(e){return s(e,new Array(e.length))},arraybuffer:function(e){return u.nodebuffer.uint8array(e).buffer},uint8array:function(e){return s(e,new Uint8Array(e.length))},nodebuffer:n},r.transformTo=function(e,t){if(t||(t=""),!e)return t;r.checkSupport(e);var n=r.getTypeOf(t);return u[n][e](t)},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":a.nodebuffer&&h.test(e)?"nodebuffer":a.uint8array&&e instanceof Uint8Array?"uint8array":a.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!a[e.toLowerCase()])throw new Error(e+" is not supported by this browser")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)n+="\\x"+(16>(t=e.charCodeAt(r))?"0":"")+t.toString(16).toUpperCase();return n},r.findCompression=function(e){for(var t in c)if(c.hasOwnProperty(t)&&c[t].magic===e)return c[t];return null},r.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t){"use strict";function r(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var n=e("./stringReader"),i=e("./nodeBufferReader"),o=e("./uint8ArrayReader"),s=e("./utils"),a=e("./signature"),c=e("./zipEntry"),h=e("./support"),u=e("./object");r.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+s.pretty(t)+", expected "+s.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=u.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;n>0;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)this.reader.setIndex((t=this.files[e]).localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===a.CENTRAL_FILE_HEADER;)(e=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(-1===e){var t=!0;try{this.reader.setIndex(0),this.checkSignature(a.LOCAL_FILE_HEADER),t=!1}catch(e){}throw new Error(t?"Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html":"Corrupted zip : can't find end of central directory")}if(this.reader.setIndex(e),this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=s.getTypeOf(e);this.reader="string"!==t||h.uint8array?"nodebuffer"===t?new i(e):new o(s.transformTo("uint8array",e)):new n(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=r},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t){"use strict";function r(e,t){this.options=e,this.loadOptions=t}var n=e("./stringReader"),i=e("./utils"),o=e("./compressedObject"),s=e("./object");r.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,r){return function(){var n=e.index;e.setIndex(t);var i=e.readData(r);return e.setIndex(n),i}},prepareContent:function(e,t,r,n,o){return function(){var e=i.transformTo(n.uncompressInputType,this.getCompressedContent()),t=n.uncompress(e);if(t.length!==o)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(r),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=i.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new o,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=i.transformTo("string",this.decompressed.getContent()),s.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readInt(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileName.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=new n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index;for(this.extraFields=this.extraFields||{};e.index<i+this.extraFieldsLength;)t=e.readInt(2),r=e.readInt(2),n=e.readString(r),this.extraFields[t]={id:t,length:r,value:n}},handleUTF8:function(){if(this.useUTF8())this.fileName=s.utf8decode(this.fileName),this.fileComment=s.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:s.crc32(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:s.crc32(this.fileComment)!==t.readInt(4)?null:s.utf8decode(t.readString(e.length-5))}return null}},t.exports=r},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t){"use strict";var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,r){"use strict";function n(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/deflate.js"),o=e("./utils/common"),s=e("./utils/strings"),a=e("./zlib/messages"),c=e("./zlib/zstream"),h=function(e){this.options=o.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var r=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(a[r]);t.header&&i.deflateSetHeader(this.strm,t.header)};h.prototype.push=function(e,t){var r,n,a=this.strm,c=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,a.input="string"==typeof e?s.string2buf(e):e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new o.Buf8(c),a.next_out=0,a.avail_out=c),1!==(r=i.deflate(a,n))&&0!==r)return this.onEnd(r),this.ended=!0,!1;(0===a.avail_out||0===a.avail_in&&4===n)&&this.onData("string"===this.options.to?s.buf2binstring(o.shrinkBuf(a.output,a.next_out)):o.shrinkBuf(a.output,a.next_out))}while((a.avail_in>0||0===a.avail_out)&&1!==r);return 4!==n||(r=i.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){0===e&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=h,r.deflate=n,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,r){"use strict";function n(e,t){var r=new l(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/inflate.js"),o=e("./utils/common"),s=e("./utils/strings"),a=e("./zlib/constants"),c=e("./zlib/messages"),h=e("./zlib/zstream"),u=e("./zlib/gzheader"),l=function(e){this.options=o.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var r=i.inflateInit2(this.strm,t.windowBits);if(r!==a.Z_OK)throw new Error(c[r]);this.header=new u,i.inflateGetHeader(this.strm,this.header)};l.prototype.push=function(e,t){var r,n,c,h,u,l=this.strm,d=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,l.input="string"==typeof e?s.binstring2buf(e):e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new o.Buf8(d),l.next_out=0,l.avail_out=d),(r=i.inflate(l,a.Z_NO_FLUSH))!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),this.ended=!0,!1;l.next_out&&(0===l.avail_out||r===a.Z_STREAM_END||0===l.avail_in&&n===a.Z_FINISH)&&("string"===this.options.to?(c=s.utf8border(l.output,l.next_out),h=l.next_out-c,u=s.buf2string(l.output,c),l.next_out=h,l.avail_out=d-h,h&&o.arraySet(l.output,l.output,c,h,0),this.onData(u)):this.onData(o.shrinkBuf(l.output,l.next_out)))}while(l.avail_in>0&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(n=a.Z_FINISH),n!==a.Z_FINISH||(r=i.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===a.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=l,r.inflate=n,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.ungzip=n},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;n>o;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,s;for(n=0,t=0,r=e.length;r>t;t++)n+=e[t].length;for(s=new Uint8Array(n),i=0,t=0,r=e.length;r>t;t++)s.set(o=e[t],i),i+=o.length;return s}},o={arraySet:function(e,t,r,n,i){for(var o=0;n>o;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(n)},{}],28:[function(e,t,r){"use strict";function n(e,t){if(65537>t&&(e.subarray&&s||!e.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var r="",n=0;t>n;n++)r+=String.fromCharCode(e[n]);return r}var i=e("./common"),o=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var a=new i.Buf8(256),c=0;256>c;c++)a[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;a[254]=a[254]=1,r.string2buf=function(e){var t,r,n,o,s,a=e.length,c=0;for(o=0;a>o;o++)55296==(64512&(r=e.charCodeAt(o)))&&a>o+1&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),c+=128>r?1:2048>r?2:65536>r?3:4;for(t=new i.Buf8(c),s=0,o=0;c>s;o++)55296==(64512&(r=e.charCodeAt(o)))&&a>o+1&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),128>r?t[s++]=r:2048>r?(t[s++]=192|r>>>6,t[s++]=128|63&r):65536>r?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|63&r):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|63&r);return t},r.buf2binstring=function(e){return n(e,e.length)},r.binstring2buf=function(e){for(var t=new i.Buf8(e.length),r=0,n=t.length;n>r;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,i,o,s,c=t||e.length,h=new Array(2*c);for(i=0,r=0;c>r;)if(128>(o=e[r++]))h[i++]=o;else if((s=a[o])>4)h[i++]=65533,r+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&c>r;)o=o<<6|63&e[r++],s--;s>1?h[i++]=65533:65536>o?h[i++]=o:(h[i++]=55296|(o-=65536)>>10&1023,h[i++]=56320|1023&o)}return n(h,i)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r?t:0===r?t:r+a[e[r]]>t?r:t}},{"./common":27}],29:[function(e,t){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,s=0;0!==r;){r-=s=r>2e3?2e3:r;do{o=o+(i=i+t[n++]|0)|0}while(--s);i%=65521,o%=65521}return i|o<<16|0}},{}],30:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t){"use strict";var r=function(){for(var e,t=[],r=0;256>r;r++){e=r;for(var n=0;8>n;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,n,i){var o=r,s=i+n;e^=-1;for(var a=i;s>a;a++)e=e>>>8^o[255&(e^t[a])];return-1^e}},{}],32:[function(e,t,r){"use strict";function n(e,t){return e.msg=x[t],t}function i(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function s(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(S.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function a(e,t){w._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,s(e.strm)}function c(e,t){e.pending_buf[e.pending++]=t}function h(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function u(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,S.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=P(e.adler,t,i,r):2===e.state.wrap&&(e.adler=B(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function l(e,t){var r,n,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,c=e.strstart>e.w_size-W?e.strstart-(e.w_size-W):0,h=e.window,u=e.w_mask,l=e.prev,d=e.strstart+q,f=h[o+s-1],p=h[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(h[(r=t)+s]===p&&h[r+s-1]===f&&h[r]===h[o]&&h[++r]===h[o+1]){o+=2,r++;do{}while(h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&d>o);if(n=q-(d-o),o=d-q,n>s){if(e.match_start=t,s=n,n>=a)break;f=h[o+s-1],p=h[o+s]}}}while((t=l[t&u])>c&&0!=--i);return s<=e.lookahead?s:e.lookahead}function d(e){var t,r,n,i,o,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-W)){S.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=s?n-s:0}while(--r);t=r=s;do{n=e.prev[--t],e.prev[t]=n>=s?n-s:0}while(--r);i+=s}if(0===e.strm.avail_in)break;if(r=u(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=M)for(e.ins_h=e.window[o=e.strstart-e.insert],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+M-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<M)););}while(e.lookahead<W&&0!==e.strm.avail_in)}function f(e,t){for(var r,n;;){if(e.lookahead<W){if(d(e),e.lookahead<W&&t===U)return X;if(0===e.lookahead)break}if(r=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-W&&(e.match_length=l(e,r)),e.match_length>=M)if(n=w._tr_tally(e,e.strstart-e.match_start,e.match_length-M),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=M){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=w._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(a(e,!1),0===e.strm.avail_out))return X}return e.insert=e.strstart<M-1?e.strstart:M-1,t===k?(a(e,!0),0===e.strm.avail_out?K:Y):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?X:Z}function p(e,t){for(var r,n,i;;){if(e.lookahead<W){if(d(e),e.lookahead<W&&t===U)return X;if(0===e.lookahead)break}if(r=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=M-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-W&&(e.match_length=l(e,r),e.match_length<=5&&(e.strategy===I||e.match_length===M&&e.strstart-e.match_start>4096)&&(e.match_length=M-1)),e.prev_length>=M&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-M,n=w._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-M),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=M-1,e.strstart++,n&&(a(e,!1),0===e.strm.avail_out))return X}else if(e.match_available){if((n=w._tr_tally(e,0,e.window[e.strstart-1]))&&a(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return X}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=w._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<M-1?e.strstart:M-1,t===k?(a(e,!0),0===e.strm.avail_out?K:Y):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?X:Z}function g(e,t){for(var r,n,i,o,s=e.window;;){if(e.lookahead<=q){if(d(e),e.lookahead<=q&&t===U)return X;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=M&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){o=e.strstart+q;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&o>i);e.match_length=q-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=M?(r=w._tr_tally(e,1,e.match_length-M),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=w._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(a(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===k?(a(e,!0),0===e.strm.avail_out?K:Y):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?X:Z}function m(e,t){for(var r;;){if(0===e.lookahead&&(d(e),0===e.lookahead)){if(t===U)return X;break}if(e.match_length=0,r=w._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(a(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===k?(a(e,!0),0===e.strm.avail_out?K:Y):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?X:Z}function y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=L,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new S.Buf16(2*D),this.dyn_dtree=new S.Buf16(2*(2*z+1)),this.bl_tree=new S.Buf16(2*(2*F+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new S.Buf16(j+1),this.heap=new S.Buf16(2*N+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new S.Buf16(2*N+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=T,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?H:V,e.adler=2===t.wrap?0:1,t.last_flush=U,w._tr_init(t),C):n(e,R)}function b(e){var t=v(e);return t===C&&function(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=_[e.level].max_lazy,e.good_match=_[e.level].good_length,e.nice_match=_[e.level].nice_length,e.max_chain_length=_[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=M-1,e.match_available=0,e.ins_h=0}(e.state),t}function E(e,t,r,i,o,s){if(!e)return R;var a=1;if(t===J&&(t=6),0>i?(a=0,i=-i):i>15&&(a=2,i-=16),1>o||o>O||r!==L||8>i||i>15||0>t||t>9||0>s||s>A)return n(e,R);8===i&&(i=9);var c=new y;return e.state=c,c.strm=e,c.wrap=a,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+M-1)/M),c.window=new S.Buf8(2*c.w_size),c.head=new S.Buf16(c.hash_size),c.prev=new S.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new S.Buf8(c.pending_buf_size),c.d_buf=c.lit_bufsize>>1,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=s,c.method=r,b(e)}var _,S=e("../utils/common"),w=e("./trees"),P=e("./adler32"),B=e("./crc32"),x=e("./messages"),U=0,k=4,C=0,R=-2,J=-1,I=1,A=4,T=2,L=8,O=9,N=286,z=30,F=19,D=2*N+1,j=15,M=3,q=258,W=q+M+1,H=42,V=113,X=1,Z=2,K=3,Y=4,G=function(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i};_=[new G(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(d(e),0===e.lookahead&&t===U)return X;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,a(e,!1),0===e.strm.avail_out))return X;if(e.strstart-e.block_start>=e.w_size-W&&(a(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===k?(a(e,!0),0===e.strm.avail_out?K:Y):(e.strstart>e.block_start&&a(e,!1),X)}),new G(4,4,8,4,f),new G(4,5,16,8,f),new G(4,6,32,32,f),new G(4,4,16,16,p),new G(8,16,32,32,p),new G(8,16,128,128,p),new G(8,32,128,256,p),new G(32,128,258,1024,p),new G(32,258,258,4096,p)],r.deflateInit=function(e,t){return E(e,t,L,15,8,0)},r.deflateInit2=E,r.deflateReset=b,r.deflateResetKeep=v,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?R:(e.state.gzhead=t,C):R},r.deflate=function(e,t){var r,a,u,l;if(!e||!e.state||t>5||0>t)return e?n(e,R):R;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||666===a.status&&t!==k)return n(e,0===e.avail_out?-5:R);if(a.strm=e,r=a.last_flush,a.last_flush=t,a.status===H)if(2===a.wrap)e.adler=0,c(a,31),c(a,139),c(a,8),a.gzhead?(c(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),c(a,255&a.gzhead.time),c(a,a.gzhead.time>>8&255),c(a,a.gzhead.time>>16&255),c(a,a.gzhead.time>>24&255),c(a,9===a.level?2:a.strategy>=2||a.level<2?4:0),c(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(c(a,255&a.gzhead.extra.length),c(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=B(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(c(a,0),c(a,0),c(a,0),c(a,0),c(a,0),c(a,9===a.level?2:a.strategy>=2||a.level<2?4:0),c(a,3),a.status=V);else{var d=L+(a.w_bits-8<<4)<<8;d|=(a.strategy>=2||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(d|=32),d+=31-d%31,a.status=V,h(a,d),0!==a.strstart&&(h(a,e.adler>>>16),h(a,65535&e.adler)),e.adler=1}if(69===a.status)if(a.gzhead.extra){for(u=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>u&&(e.adler=B(e.adler,a.pending_buf,a.pending-u,u)),s(e),u=a.pending,a.pending!==a.pending_buf_size));)c(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>u&&(e.adler=B(e.adler,a.pending_buf,a.pending-u,u)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){u=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>u&&(e.adler=B(e.adler,a.pending_buf,a.pending-u,u)),s(e),u=a.pending,a.pending===a.pending_buf_size)){l=1;break}l=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,c(a,l)}while(0!==l);a.gzhead.hcrc&&a.pending>u&&(e.adler=B(e.adler,a.pending_buf,a.pending-u,u)),0===l&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){u=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>u&&(e.adler=B(e.adler,a.pending_buf,a.pending-u,u)),s(e),u=a.pending,a.pending===a.pending_buf_size)){l=1;break}l=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,c(a,l)}while(0!==l);a.gzhead.hcrc&&a.pending>u&&(e.adler=B(e.adler,a.pending_buf,a.pending-u,u)),0===l&&(a.status=103)}else a.status=103;if(103===a.status&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&s(e),a.pending+2<=a.pending_buf_size&&(c(a,255&e.adler),c(a,e.adler>>8&255),e.adler=0,a.status=V)):a.status=V),0!==a.pending){if(s(e),0===e.avail_out)return a.last_flush=-1,C}else if(0===e.avail_in&&i(t)<=i(r)&&t!==k)return n(e,-5);if(666===a.status&&0!==e.avail_in)return n(e,-5);if(0!==e.avail_in||0!==a.lookahead||t!==U&&666!==a.status){var f=2===a.strategy?m(a,t):3===a.strategy?g(a,t):_[a.level].func(a,t);if((f===K||f===Y)&&(a.status=666),f===X||f===K)return 0===e.avail_out&&(a.last_flush=-1),C;if(f===Z&&(1===t?w._tr_align(a):5!==t&&(w._tr_stored_block(a,0,0,!1),3===t&&(o(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),s(e),0===e.avail_out))return a.last_flush=-1,C}return t!==k?C:a.wrap<=0?1:(2===a.wrap?(c(a,255&e.adler),c(a,e.adler>>8&255),c(a,e.adler>>16&255),c(a,e.adler>>24&255),c(a,255&e.total_in),c(a,e.total_in>>8&255),c(a,e.total_in>>16&255),c(a,e.total_in>>24&255)):(h(a,e.adler>>>16),h(a,65535&e.adler)),s(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?C:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==H&&69!==t&&73!==t&&91!==t&&103!==t&&t!==V&&666!==t?n(e,R):(e.state=null,t===V?n(e,-3):C):R},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],34:[function(e,t){"use strict";t.exports=function(e,t){var r,n,i,o,s,a,c,h,u,l,d,f,p,g,m,y,v,b,E,_,S,w,P,B,x;B=e.input,i=(n=e.next_in)+(e.avail_in-5),x=e.output,s=(o=e.next_out)-(t-e.avail_out),a=o+(e.avail_out-257),c=(r=e.state).dmax,h=r.wsize,u=r.whave,l=r.wnext,d=r.window,f=r.hold,p=r.bits,g=r.lencode,m=r.distcode,y=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{15>p&&(f+=B[n++]<<p,f+=B[n++]<<(p+=8),p+=8),b=g[f&y];t:for(;;){if(f>>>=E=b>>>24,p-=E,0==(E=b>>>16&255))x[o++]=65535&b;else{if(!(16&E)){if(0==(64&E)){b=g[(65535&b)+(f&(1<<E)-1)];continue t}if(32&E){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}_=65535&b,(E&=15)&&(E>p&&(f+=B[n++]<<p,p+=8),_+=f&(1<<E)-1,f>>>=E,p-=E),15>p&&(f+=B[n++]<<p,f+=B[n++]<<(p+=8),p+=8),b=m[f&v];r:for(;;){if(f>>>=E=b>>>24,p-=E,!(16&(E=b>>>16&255))){if(0==(64&E)){b=m[(65535&b)+(f&(1<<E)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(S=65535&b,(E&=15)>p&&(f+=B[n++]<<p,E>(p+=8)&&(f+=B[n++]<<p,p+=8)),(S+=f&(1<<E)-1)>c){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=E,p-=E,S>(E=o-s)){if((E=S-E)>u&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(w=0,P=d,0===l){if(w+=h-E,_>E){_-=E;do{x[o++]=d[w++]}while(--E);w=o-S,P=x}}else if(E>l){if(w+=h+l-E,_>(E-=l)){_-=E;do{x[o++]=d[w++]}while(--E);if(w=0,_>l){_-=E=l;do{x[o++]=d[w++]}while(--E);w=o-S,P=x}}}else if(w+=l-E,_>E){_-=E;do{x[o++]=d[w++]}while(--E);w=o-S,P=x}for(;_>2;)x[o++]=P[w++],x[o++]=P[w++],x[o++]=P[w++],_-=3;_&&(x[o++]=P[w++],_>1&&(x[o++]=P[w++]))}else{w=o-S;do{x[o++]=x[w++],x[o++]=x[w++],x[o++]=x[w++],_-=3}while(_>2);_&&(x[o++]=x[w++],_>1&&(x[o++]=x[w++]))}break}}break}}while(i>n&&a>o);f&=(1<<(p-=(_=p>>3)<<3))-1,e.next_in=n-=_,e.next_out=o,e.avail_in=i>n?i-n+5:5-(n-i),e.avail_out=a>o?a-o+257:257-(o-a),r.hold=f,r.bits=p}},{}],35:[function(e,t,r){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=E,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new l.Buf32(S),t.distcode=t.distdyn=new l.Buf32(w),t.sane=1,t.back=-1,v):b}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,i(e)):b}function s(e,t){var r,n;return e&&e.state?(n=e.state,0>t?(r=0,t=-t):(r=1+(t>>4),48>t&&(t&=15)),t&&(8>t||t>15)?b:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):b}function a(e,t){var r,n;return e?(n=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new l.Buf16(320),this.work=new l.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=n,n.window=null,(r=s(e,t))!==v&&(e.state=null),r):b}function c(e){if(P){var t;for(h=new l.Buf32(512),u=new l.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(g(m,e.lens,0,288,h,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;g(y,e.lens,0,32,u,0,e.work,{bits:5}),P=!1}e.lencode=h,e.lenbits=9,e.distcode=u,e.distbits=5}var h,u,l=e("../utils/common"),d=e("./adler32"),f=e("./crc32"),p=e("./inffast"),g=e("./inftrees"),m=1,y=2,v=0,b=-2,E=1,_=12,S=852,w=592,P=!0;r.inflateReset=o,r.inflateReset2=s,r.inflateResetKeep=i,r.inflateInit=function(e){return a(e,15)},r.inflateInit2=a,r.inflate=function(e,t){var r,i,o,s,a,h,u,S,w,P,B,x,U,k,C,R,J,I,A,T,L,O,N,z,F=0,D=new l.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return b;(r=e.state).mode===_&&(r.mode=13),a=e.next_out,o=e.output,s=e.next_in,i=e.input,S=r.hold,w=r.bits,P=h=e.avail_in,B=u=e.avail_out,O=v;e:for(;;)switch(r.mode){case E:if(0===r.wrap){r.mode=13;break}for(;16>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if(2&r.wrap&&35615===S){r.check=0,D[0]=255&S,D[1]=S>>>8&255,r.check=f(r.check,D,2,0),S=0,w=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&S)<<8)+(S>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&S)){e.msg="unknown compression method",r.mode=30;break}if(w-=4,L=8+(15&(S>>>=4)),0===r.wbits)r.wbits=L;else if(L>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<L,e.adler=r.check=1,r.mode=512&S?10:_,S=0,w=0;break;case 2:for(;16>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if(r.flags=S,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=S>>8&1),512&r.flags&&(D[0]=255&S,D[1]=S>>>8&255,r.check=f(r.check,D,2,0)),S=0,w=0,r.mode=3;case 3:for(;32>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}r.head&&(r.head.time=S),512&r.flags&&(D[0]=255&S,D[1]=S>>>8&255,D[2]=S>>>16&255,D[3]=S>>>24&255,r.check=f(r.check,D,4,0)),S=0,w=0,r.mode=4;case 4:for(;16>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}r.head&&(r.head.xflags=255&S,r.head.os=S>>8),512&r.flags&&(D[0]=255&S,D[1]=S>>>8&255,r.check=f(r.check,D,2,0)),S=0,w=0,r.mode=5;case 5:if(1024&r.flags){for(;16>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}r.length=S,r.head&&(r.head.extra_len=S),512&r.flags&&(D[0]=255&S,D[1]=S>>>8&255,r.check=f(r.check,D,2,0)),S=0,w=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((x=r.length)>h&&(x=h),x&&(r.head&&(L=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),l.arraySet(r.head.extra,i,s,x,L)),512&r.flags&&(r.check=f(r.check,i,x,s)),h-=x,s+=x,r.length-=x),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===h)break e;x=0;do{L=i[s+x++],r.head&&L&&r.length<65536&&(r.head.name+=String.fromCharCode(L))}while(L&&h>x);if(512&r.flags&&(r.check=f(r.check,i,x,s)),h-=x,s+=x,L)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===h)break e;x=0;do{L=i[s+x++],r.head&&L&&r.length<65536&&(r.head.comment+=String.fromCharCode(L))}while(L&&h>x);if(512&r.flags&&(r.check=f(r.check,i,x,s)),h-=x,s+=x,L)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;16>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if(S!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}S=0,w=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=_;break;case 10:for(;32>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}e.adler=r.check=n(S),S=0,w=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=u,e.next_in=s,e.avail_in=h,r.hold=S,r.bits=w,2;e.adler=r.check=1,r.mode=_;case _:if(5===t||6===t)break e;case 13:if(r.last){S>>>=7&w,w-=7&w,r.mode=27;break}for(;3>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}switch(r.last=1&S,w-=1,3&(S>>>=1)){case 0:r.mode=14;break;case 1:if(c(r),r.mode=20,6===t){S>>>=2,w-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}S>>>=2,w-=2;break;case 14:for(S>>>=7&w,w-=7&w;32>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if((65535&S)!=(S>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&S,S=0,w=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(x=r.length){if(x>h&&(x=h),x>u&&(x=u),0===x)break e;l.arraySet(o,i,s,x,a),h-=x,s+=x,u-=x,a+=x,r.length-=x;break}r.mode=_;break;case 17:for(;14>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if(r.nlen=257+(31&S),w-=5,r.ndist=1+(31&(S>>>=5)),w-=5,r.ncode=4+(15&(S>>>=5)),S>>>=4,w-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;3>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}r.lens[j[r.have++]]=7&S,S>>>=3,w-=3}for(;r.have<19;)r.lens[j[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,O=g(0,r.lens,0,19,r.lencode,0,r.work,N={bits:r.lenbits}),r.lenbits=N.bits,O){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;R=(F=r.lencode[S&(1<<r.lenbits)-1])>>>16&255,J=65535&F,!(w>=(C=F>>>24));){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if(16>J)S>>>=C,w-=C,r.lens[r.have++]=J;else{if(16===J){for(z=C+2;z>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if(S>>>=C,w-=C,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}L=r.lens[r.have-1],x=3+(3&S),S>>>=2,w-=2}else if(17===J){for(z=C+3;z>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}w-=C,L=0,x=3+(7&(S>>>=C)),S>>>=3,w-=3}else{for(z=C+7;z>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}w-=C,L=0,x=11+(127&(S>>>=C)),S>>>=7,w-=7}if(r.have+x>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;x--;)r.lens[r.have++]=L}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,O=g(m,r.lens,0,r.nlen,r.lencode,0,r.work,N={bits:r.lenbits}),r.lenbits=N.bits,O){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,O=g(y,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,N={bits:r.distbits}),r.distbits=N.bits,O){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(h>=6&&u>=258){e.next_out=a,e.avail_out=u,e.next_in=s,e.avail_in=h,r.hold=S,r.bits=w,p(e,B),a=e.next_out,o=e.output,u=e.avail_out,s=e.next_in,i=e.input,h=e.avail_in,S=r.hold,w=r.bits,r.mode===_&&(r.back=-1);break}for(r.back=0;R=(F=r.lencode[S&(1<<r.lenbits)-1])>>>16&255,J=65535&F,!(w>=(C=F>>>24));){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if(R&&0==(240&R)){for(I=C,A=R,T=J;R=(F=r.lencode[T+((S&(1<<I+A)-1)>>I)])>>>16&255,J=65535&F,!(w>=I+(C=F>>>24));){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}S>>>=I,w-=I,r.back+=I}if(S>>>=C,w-=C,r.back+=C,r.length=J,0===R){r.mode=26;break}if(32&R){r.back=-1,r.mode=_;break}if(64&R){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&R,r.mode=22;case 22:if(r.extra){for(z=r.extra;z>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}r.length+=S&(1<<r.extra)-1,S>>>=r.extra,w-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;R=(F=r.distcode[S&(1<<r.distbits)-1])>>>16&255,J=65535&F,!(w>=(C=F>>>24));){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if(0==(240&R)){for(I=C,A=R,T=J;R=(F=r.distcode[T+((S&(1<<I+A)-1)>>I)])>>>16&255,J=65535&F,!(w>=I+(C=F>>>24));){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}S>>>=I,w-=I,r.back+=I}if(S>>>=C,w-=C,r.back+=C,64&R){e.msg="invalid distance code",r.mode=30;break}r.offset=J,r.extra=15&R,r.mode=24;case 24:if(r.extra){for(z=r.extra;z>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}r.offset+=S&(1<<r.extra)-1,S>>>=r.extra,w-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===u)break e;if(r.offset>(x=B-u)){if((x=r.offset-x)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}U=x>r.wnext?r.wsize-(x-=r.wnext):r.wnext-x,x>r.length&&(x=r.length),k=r.window}else k=o,U=a-r.offset,x=r.length;x>u&&(x=u),u-=x,r.length-=x;do{o[a++]=k[U++]}while(--x);0===r.length&&(r.mode=21);break;case 26:if(0===u)break e;o[a++]=r.length,u--,r.mode=21;break;case 27:if(r.wrap){for(;32>w;){if(0===h)break e;h--,S|=i[s++]<<w,w+=8}if(e.total_out+=B-=u,r.total+=B,B&&(e.adler=r.check=r.flags?f(r.check,o,B,a-B):d(r.check,o,B,a-B)),B=u,(r.flags?S:n(S))!==r.check){e.msg="incorrect data check",r.mode=30;break}S=0,w=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;32>w;){if(0===h)break e;h--,S+=i[s++]<<w,w+=8}if(S!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}S=0,w=0}r.mode=29;case 29:O=1;break e;case 30:O=-3;break e;case 31:return-4;case 32:default:return b}return e.next_out=a,e.avail_out=u,e.next_in=s,e.avail_in=h,r.hold=S,r.bits=w,(r.wsize||B!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&function(e,t,r,n){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new l.Buf8(o.wsize)),n>=o.wsize?(l.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>n&&(i=n),l.arraySet(o.window,t,r-n,i,o.wnext),(n-=i)?(l.arraySet(o.window,t,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}(e,e.output,e.next_out,B-e.avail_out)?(r.mode=31,-4):(B-=e.avail_out,e.total_in+=P-=e.avail_in,e.total_out+=B,r.total+=B,r.wrap&&B&&(e.adler=r.check=r.flags?f(r.check,o,B,e.next_out-B):d(r.check,o,B,e.next_out-B)),e.data_type=r.bits+(r.last?64:0)+(r.mode===_?128:0)+(20===r.mode||15===r.mode?256:0),(0===P&&0===B||4===t)&&O===v&&(O=-5),O)},r.inflateEnd=function(e){if(!e||!e.state)return b;var t=e.state;return t.window&&(t.window=null),e.state=null,v},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?b:(r.head=t,t.done=!1,v):b},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t){"use strict";var r=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,a,c,h,u,l,d){var f,p,g,m,y,v,b,E,_,S=d.bits,w=0,P=0,B=0,x=0,U=0,k=0,C=0,R=0,J=0,I=0,A=null,T=0,L=new r.Buf16(16),O=new r.Buf16(16),N=null,z=0;for(w=0;15>=w;w++)L[w]=0;for(P=0;c>P;P++)L[t[a+P]]++;for(U=S,x=15;x>=1&&0===L[x];x--);if(U>x&&(U=x),0===x)return h[u++]=20971520,h[u++]=20971520,d.bits=1,0;for(B=1;x>B&&0===L[B];B++);for(B>U&&(U=B),R=1,w=1;15>=w;w++)if(R<<=1,0>(R-=L[w]))return-1;if(R>0&&(0===e||1!==x))return-1;for(O[1]=0,w=1;15>w;w++)O[w+1]=O[w]+L[w];for(P=0;c>P;P++)0!==t[a+P]&&(l[O[t[a+P]]++]=P);if(0===e?(A=N=l,v=19):1===e?(A=n,T-=257,N=i,z-=257,v=256):(A=o,N=s,v=-1),I=0,P=0,w=B,y=u,k=U,C=0,g=-1,m=(J=1<<U)-1,1===e&&J>852||2===e&&J>592)return 1;for(;;){b=w-C,l[P]<v?(E=0,_=l[P]):l[P]>v?(E=N[z+l[P]],_=A[T+l[P]]):(E=96,_=0),f=1<<w-C,B=p=1<<k;do{h[y+(I>>C)+(p-=f)]=b<<24|E<<16|_|0}while(0!==p);for(f=1<<w-1;I&f;)f>>=1;if(0!==f?(I&=f-1,I+=f):I=0,P++,0==--L[w]){if(w===x)break;w=t[a+l[P]]}if(w>U&&(I&m)!==g){for(0===C&&(C=U),y+=B,R=1<<(k=w-C);x>k+C&&!(0>=(R-=L[k+C]));)k++,R<<=1;if(J+=1<<k,1===e&&J>852||2===e&&J>592)return 1;h[g=I&m]=U<<24|k<<16|y-u|0}}return 0!==I&&(h[y+I]=w-C<<24|64<<16|0),d.bits=U,0}},{"../utils/common":27}],37:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,r){"use strict";function n(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e){return 256>e?z[e]:z[256+(e>>>7)]}function o(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function s(e,t,r){e.bi_valid>U-r?(e.bi_buf|=t<<e.bi_valid&65535,o(e,e.bi_buf),e.bi_buf=t>>U-e.bi_valid,e.bi_valid+=r-U):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function a(e,t,r){s(e,r[2*t],r[2*t+1])}function c(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function h(e,t,r){var n,i,o=new Array(x+1),s=0;for(n=1;x>=n;n++)o[n]=s=s+r[n-1]<<1;for(i=0;t>=i;i++){var a=e[2*i+1];0!==a&&(e[2*i]=c(o[a]++,a))}}function u(e){var t;for(t=0;S>t;t++)e.dyn_ltree[2*t]=0;for(t=0;w>t;t++)e.dyn_dtree[2*t]=0;for(t=0;P>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*k]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function l(e){e.bi_valid>8?o(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function d(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function f(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&d(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!d(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function p(e,t,r){var n,o,c,h,u=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],o=e.pending_buf[e.l_buf+u],u++,0===n?a(e,o,t):(a(e,(c=F[o])+_+1,t),0!==(h=I[c])&&s(e,o-=D[c],h),a(e,c=i(--n),r),0!==(h=A[c])&&s(e,n-=j[c],h))}while(u<e.last_lit);a(e,k,t)}function g(e,t){var r,n,i,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=B,r=0;c>r;r++)0!==o[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=2>u?++u:0)]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=s[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)f(e,o,r);i=c;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],f(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,f(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,o,s,a,c=t.dyn_tree,h=t.max_code,u=t.stat_desc.static_tree,l=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(o=0;x>=o;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;B>r;r++)(o=c[2*c[2*(n=e.heap[r])+1]+1]+1)>p&&(o=p,g++),c[2*n+1]=o,n>h||(e.bl_count[o]++,s=0,n>=f&&(s=d[n-f]),e.opt_len+=(a=c[2*n])*(o+s),l&&(e.static_len+=a*(u[2*n+1]+s)));if(0!==g){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,g-=2}while(g>0);for(o=p;0!==o;o--)for(n=e.bl_count[o];0!==n;)(i=e.heap[--r])>h||(c[2*i+1]!==o&&(e.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),n--)}}(e,t),h(o,u,e.bl_count)}function m(e,t,r){var n,i,o=-1,s=t[1],a=0,c=7,h=4;for(0===s&&(c=138,h=3),t[2*(r+1)+1]=65535,n=0;r>=n;n++)i=s,s=t[2*(n+1)+1],++a<c&&i===s||(h>a?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*C]++):10>=a?e.bl_tree[2*R]++:e.bl_tree[2*J]++,a=0,o=i,0===s?(c=138,h=3):i===s?(c=6,h=3):(c=7,h=4))}function y(e,t,r){var n,i,o=-1,c=t[1],h=0,u=7,l=4;for(0===c&&(u=138,l=3),n=0;r>=n;n++)if(i=c,c=t[2*(n+1)+1],!(++h<u&&i===c)){if(l>h)do{a(e,i,e.bl_tree)}while(0!=--h);else 0!==i?(i!==o&&(a(e,i,e.bl_tree),h--),a(e,C,e.bl_tree),s(e,h-3,2)):10>=h?(a(e,R,e.bl_tree),s(e,h-3,3)):(a(e,J,e.bl_tree),s(e,h-11,7));h=0,o=i,0===c?(u=138,l=3):i===c?(u=6,l=3):(u=7,l=4)}}function v(e,t,r,n){s(e,(E<<1)+(n?1:0),3),function(e,t,r,n){l(e),o(e,r),o(e,~r),b.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r)}var b=e("../utils/common"),E=0,_=256,S=_+1+29,w=30,P=19,B=2*S+1,x=15,U=16,k=256,C=16,R=17,J=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=new Array(2*(S+2));n(O);var N=new Array(2*w);n(N);var z=new Array(512);n(z);var F=new Array(256);n(F);var D=new Array(29);n(D);var j=new Array(w);n(j);var M,q,W,H=function(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length},V=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},X=!1;r._tr_init=function(e){X||(function(){var e,t,r,n,i,o=new Array(x+1);for(r=0,n=0;28>n;n++)for(D[n]=r,e=0;e<1<<I[n];e++)F[r++]=n;for(F[r-1]=n,i=0,n=0;16>n;n++)for(j[n]=i,e=0;e<1<<A[n];e++)z[i++]=n;for(i>>=7;w>n;n++)for(j[n]=i<<7,e=0;e<1<<A[n]-7;e++)z[256+i++]=n;for(t=0;x>=t;t++)o[t]=0;for(e=0;143>=e;)O[2*e+1]=8,e++,o[8]++;for(;255>=e;)O[2*e+1]=9,e++,o[9]++;for(;279>=e;)O[2*e+1]=7,e++,o[7]++;for(;287>=e;)O[2*e+1]=8,e++,o[8]++;for(h(O,S+1,o),e=0;w>e;e++)N[2*e+1]=5,N[2*e]=c(e,5);M=new H(O,I,_+1,S,x),q=new H(N,A,0,w,x),W=new H(new Array(0),T,0,P,7)}(),X=!0),e.l_desc=new V(e.dyn_ltree,M),e.d_desc=new V(e.dyn_dtree,q),e.bl_desc=new V(e.bl_tree,W),e.bi_buf=0,e.bi_valid=0,u(e)},r._tr_stored_block=v,r._tr_flush_block=function(e,t,r,n){var i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;31>=t;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;_>t;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),g(e,e.l_desc),g(e,e.d_desc),a=function(e){var t;for(m(e,e.dyn_ltree,e.l_desc.max_code),m(e,e.dyn_dtree,e.d_desc.max_code),g(e,e.bl_desc),t=P-1;t>=3&&0===e.bl_tree[2*L[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(i=e.opt_len+3+7>>>3)>=(o=e.static_len+3+7>>>3)&&(i=o)):i=o=r+5,i>=r+4&&-1!==t?v(e,t,r,n):4===e.strategy||o===i?(s(e,2+(n?1:0),3),p(e,O,N)):(s(e,4+(n?1:0),3),function(e,t,r,n){var i;for(s(e,t-257,5),s(e,r-1,5),s(e,n-4,4),i=0;n>i;i++)s(e,e.bl_tree[2*L[i]+1],3);y(e,e.dyn_ltree,t-1),y(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),p(e,e.dyn_ltree,e.dyn_dtree)),u(e),n&&l(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(F[r]+_+1)]++,e.dyn_dtree[2*i(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){s(e,2,3),a(e,k,O),function(e){16===e.bi_valid?(o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":27}],39:[function(e,t){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[9])(9)}),EPUBJS.Hooks.register("beforeChapterDisplay").endnotes=function(e,t){var r=t.contents.querySelectorAll("a[href]"),n=Array.prototype.slice.call(r),i=(EPUBJS.core.folder(location.pathname),{});EPUBJS.core.addCss(EPUBJS.cssPath+"popup.css",!1,t.render.document.head),n.forEach(function(e){var r,n,o,s,a,c;function h(){i[n].classList.add("on")}function u(){i[n].classList.remove("on")}function l(){setTimeout(function(){i[n].classList.remove("show")},100)}"noteref"==e.getAttribute("epub:type")&&(r=e.getAttribute("href"),n=r.replace("#",""),o=t.render.document.getElementById(n),e.addEventListener("mouseover",function(){var r,d,f=t.height,p=t.width,g=225;c||(r=o.cloneNode(!0),c=r.querySelector("p")),i[n]||(i[n]=document.createElement("div"),i[n].setAttribute("class","popup"),pop_content=document.createElement("div"),i[n].appendChild(pop_content),pop_content.appendChild(c),pop_content.setAttribute("class","pop_content"),t.render.document.body.appendChild(i[n]),i[n].addEventListener("mouseover",h,!1),i[n].addEventListener("mouseout",u,!1),t.on("renderer:pageChanged",l,this),t.on("renderer:pageChanged",u,this)),r=i[n],d=e.getBoundingClientRect(),s=d.left,a=d.top,r.classList.add("show"),popRect=r.getBoundingClientRect(),r.style.left=s-popRect.width/2+"px",r.style.top=a+"px",g>f/2.5&&(g=f/2.5,pop_content.style.maxHeight=g+"px"),popRect.height+a>=f-25?(r.style.top=a-popRect.height+"px",r.classList.add("above")):r.classList.remove("above"),s-popRect.width<=0?(r.style.left=s+"px",r.classList.add("left")):r.classList.remove("left"),s+popRect.width/2>=p?(r.style.left=s-300+"px",popRect=r.getBoundingClientRect(),r.style.left=s-popRect.width+"px",popRect.height+a>=f-25?(r.style.top=a-popRect.height+"px",r.classList.add("above")):r.classList.remove("above"),r.classList.add("right")):r.classList.remove("right")},!1),e.addEventListener("mouseout",l,!1))}),e&&e()},EPUBJS.Hooks.register("beforeChapterDisplay").smartimages=function(e,t){var r=t.contents.querySelectorAll("img"),n=Array.prototype.slice.call(r),i=t.height;"reflowable"==t.layoutSettings.layout?(n.forEach(function(e){var r=function(){var r,n=e.getBoundingClientRect(),o=n.height,s=n.top,a=e.getAttribute("data-height")||o,c=Number(getComputedStyle(e,"").fontSize.match(/(\d*(\.\d*)?)px/)[1]),h=c?c/2:0;i=t.contents.clientHeight,s<0&&(s=0),e.style.maxWidth="100%",a+s>=i?(s<i/2?(e.style.maxHeight=(r=i-s-h)+"px",e.style.width="auto"):(a>i&&(e.style.maxHeight=i+"px",e.style.width="auto",a=(n=e.getBoundingClientRect()).height),e.style.display="block",e.style.WebkitColumnBreakBefore="always",e.style.breakBefore="column"),e.setAttribute("data-height",r)):(e.style.removeProperty("max-height"),e.style.removeProperty("margin-top"))};e.addEventListener("load",r,!1),t.on("renderer:resized",r),t.on("renderer:chapterUnload",function(){t.off("renderer:resized",r),t.off("renderer:chapterUnload",this)}),r()}),e&&e()):e()},EPUBJS.Hooks.register("beforeChapterDisplay").transculsions=function(e,t){var r=t.contents.querySelectorAll("[transclusion]");Array.prototype.slice.call(r).forEach(function(e){var r,n=e.getAttribute("ref"),i=document.createElement("iframe"),o=e.getAttribute("width"),s=e.getAttribute("height"),a=e.parentNode,c=o,h=s;function u(){h=s,(c=o)>chapter.colWidth&&(r=chapter.colWidth/c,c=chapter.colWidth,h*=r),i.width=c,i.height=h}u(),t.listenUntil("renderer:resized","renderer:chapterUnloaded",u),i.src=n,a.replaceChild(i,e)}),e&&e()},EPUBJS.Hooks.register("beforeChapterDisplay").mathml=function(e,t){if(-1!==t.currentChapter.manifestProperties.indexOf("mathml")){t.render.iframe.contentWindow.mathmlCallback=e;var r=document.createElement("script");r.type="text/x-mathjax-config",r.innerHTML='        MathJax.Hub.Register.StartupHook("End",function () {           window.mathmlCallback();         });        MathJax.Hub.Config({jax: ["input/TeX","input/MathML","output/SVG"],extensions: ["tex2jax.js","mml2jax.js","MathEvents.js"],TeX: {extensions: ["noErrors.js","noUndefined.js","autoload-all.js"]},MathMenu: {showRenderer: false},menuSettings: {zoom: "Click"},messageStyle: "none"});                 ',t.doc.body.appendChild(r),EPUBJS.core.addScript("https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML",null,t.doc.head)}else e&&e()};